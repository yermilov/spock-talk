= What Mr. Spock would possibly say about modern unit testing: pragmatic and emotional overview
Yaroslav Yermilov <https://github.com/yermilov[icon:github[] @yermilov] https://twitter.com/yermilov17[icon:twitter[] @yermilov17] https://www.facebook.com/yaroslav.yermilov[icon:facebook[] @yaroslav.yermilov]>
2016 May 20
:toc:
:icons: font
:linkattrs:

== Original Talk

This is a textual version of link:http://jeeconf.com/program/what-mr-spock-would-possibly-say-about-modern-unit-testing-pragmatic-and-emotional-overview/[the talk given at JEEConf 2016, window="_blank"].

Recorded talk:

video::3nSXDEj7sKM[youtube, width=560, height=315, opts="allowfullscreen"]

Slides from the talk:

pass:[<iframe src="http://www.slideshare.net/slideshow/embed_code/key/ehE5vzQ7yu5map" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>]

== Code Examples

All code examples can be found link:https://github.com/yermilov/spock-talk[at GitHub, window="_blank"].

== About Me

I have 5 year experience working in the Java world starting from Intern in EPAM Systems to Senior Software Engineer today in the same company.
Most of this time I've worked in Big Data area, developing various extensions for Hadoop-family tools. Almost accidentally, 2 years ago I became responsible for automated testing on my project.
Out of work, I'm inspired by Groovy ecosystem and data science.

== What's about modern unit testing?

To my mind, automated testing is one of the most powerful software development concept suggested so far.
After receiving great attention as part of XP manifesto, it made possible to increase size of projects and complexity of code we are able to maintain by orders of magnitude.

link:http://junit.org/[JUnit, window="_blank"], started by Kent Beck and Erich Gamma, played key role in the development of the automated testing idea as it was one of the first ever and surely the most popular and influential automated testing library.

link:http://testng.org/[TestNG, window="_blank"], started by CÃ©dric Beust, was inspired by JUnit and initiated to offer wider and more powerful range of functionalities than JUnit originally does, keeping the same general concept. Later, most of the TestNG initiatives were implemented by JUnit.

As link:http://blog.takipi.com/the-top-100-java-libraries-in-2016-after-analyzing-47251-dependencies/[recent study, window="_blank"] shows, JUnit is used by about amazingly 60% of Java projects and TestNG shows quite strong result of about 6%.

.Source: http://blog.takipi.com/the-top-100-java-libraries-in-2016-after-analyzing-47251-dependencies/
image::images\spock-11ca2.png[]

Both JUnit and TestNG shares the same framework architecture often called xUnit (surprisingly after SUnit and JUnit itself).
It's described best by two concepts: test structure and assertions. As test structure obviously is set of features to describe tests organization, and assertion is a function that verifies the behavior (or the state) of the unit under test.
If we look at the most simple JUnit and TestNG tests we will found them quite similarly implementing both concepts:

[source,java]
.Easy JUnit start
----
import org.junit.Test;
import static org.junit.Assert.assertEquals;

@Test // <1>
public void arrayList_length_ind() {
    ArrayList<String> list = new ArrayList<>();
    list.add("we");
    list.add("all");
    list.add("love");
    list.add("junit");
    assertEquals(list.size(), 4); // <2>
}
----
<1> Test structure
<2> Assertion

[source,java]
.Easy TestNG start
----
import org.testng.annotations.Test;
import static org.testng.Assert.assertEquals;

@Test // <1>
public void arrayList_length_ind() {
    ArrayList<String> list = new ArrayList<>();
    list.add("we");
    list.add("all");
    list.add("love");
    list.add("testng");
    assertEquals(list.size(), 4); <2>
}
----
<1> Test structure
<2> Assertion

Actually, except for import statements, these code snippets are the same.
My feel is that, not arguing with all benefits of JUnit and TestNG, they both were frozen long time ago and no longer evolving.
Since 2013, there were 0 (zero!) major releases of traditional test frameworks. All we have for the last 3 years is one JUnit 4.12 release and several TestNG 6.9 releases. Actually, Spock is the only one, having epochal 1.0 release recently.

image::images\spock-10799.png[]

Offering great functionality in this moment, JUnit and TestNG are at risk of missing latest software engineering requests and trends.
However, JUnit is ready to overcome this problem with 5.0 release, scheduled for this year.

Anyway, there are several possibilities for passionate developers to continue evolving their test automation instruments. Let's examine them shortly.

=== JUnit 5

We can just wait until traditional tools will attempt to make revolutionary changes. Sounds not very promising, but sometimes miracles happen. link:http://junit.org/junit5/[JUnit 5, window="_blank"] is on the way to final release after link:https://www.indiegogo.com/projects/junit-lambda#/[very successful crowdfunding campaign on Indiegogo, window="_blank"].

For now we can only examine alpha releases, but we already can see that after a great work of JUnit team we will get a fresh new look at how JUnit should be implemented.
The most significant change is introduction of solid testing backend model, but it's not a main topic of this article.
Let's check how the simpliest JUnit 5 test looks like. How many changes you can see?

[source,java]
.Easy JUnit 5 start
----
import org.junit.gen5.api.Test; // <1>
import static org.junit.gen5.api.Assertions.assertEquals;

@Test // <2>
public void arrayList_length_idm() {
    ArrayList<String> list = new ArrayList<>();
    list.add("we");
    list.add("all");
    list.add("love");
    list.add("junit");
    list.add("5");
    assertEquals(5, list.size()); // <3> <4>
}
----
<1> Worked in May 2016. It's alpha, so I bet it's now working already.
<2> Test structure
<3> Assertion
<4> Changes!

=== Steroids

We can use one of plenty libraries that boost test code quality: link:http://hamcrest.org/JavaHamcrest/[Hamcrest, window="_blank"] (used by ~4% Java projects), link:http://joel-costigliola.github.io/assertj/[AssertJ, window="_blank"] (used by ~3% Java projects), link:http://google.github.io/truth/[Google Truth, window="_blank"] for assertions; link:http://mockito.org/[Mockito, window="_blank"] (used by ~10% Java projects), link:https://github.com/jayway/powermock[PowerMock, window="_blank"] (used by ~1.5% Java projects), link:http://jmockit.org/[JMockit, window="_blank"], link:http://easymock.org/[EasyMock, window="_blank"] (used by ~3% Java projects) for mocking and stubbing and probably some others like link:https://github.com/spring-projects/spring-framework/tree/master/spring-test[Spring Test, window="_blank"] (used by ~6% Java projects).

Actually I hope in the year 2016, no one is writing tests that looks like ones I've already shown.
As a base rule, they should be at least two steps forward: test should have clear inner structure and assertion should clearly explain its intent:

[source,java]
.Easy, but idiomatic JUnit start
----
@Test // <1>
public void arrayList_length_idm() {
    // setup // <2>
    ArrayList<String> list = new ArrayList<>();

    // run // <2>
    list.add("we");
    list.add("all");
    list.add("love");
    list.add("junit");

    // verify // <2>
    assertThat(list, hasSize(4)); // <3>
}
----
<1> Outer test structure
<2> Inner test structure
<3> Assertion

=== Spock

Finally, we can make really big step forward and try completely new testing approach - link:http://docs.spockframework.org/[Spock, window="_blank"].
As big steps are much more effective when they are done immediatelly, here is a very simple Spock test (Spock developers call them *specifications*).
If you write tests that looks like the last example, it will be very simple for you to get what is going on there:

[source,groovy]
.Easy Spock start
----
class N04S_EasyStart extends Specification { // <1>

    def arrayList_length() { // <1>
        setup: // <2>
        ArrayList<String> list = new ArrayList<>();

        when: // <2>
        list.add("we");
        list.add("will");
        list.add("love");
        list.add("spock");

        then: // <2>
        assertThat(list, hasSize(4)); // <3>
    }
}
----
<1> Outer test structure
<2> Inner test structure
<3> Assertion

== Why try Spock?

== How to start with Spock?

== Advanced and hidden features

== What JUnit/TestNG/Mockito offers instead?

== Why use Spock?

== Why do not use Spock?

== When use Spock?
