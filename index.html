<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<meta name="author" content="Yaroslav Yermilov">
<title>What Mr. Spock would possibly say about modern unit testing: pragmatic and emotional overview</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>What Mr. Spock would possibly say about modern unit testing: pragmatic and emotional overview</h1>
<div class="details">
<span id="author" class="author">Yaroslav Yermilov</span><br>
<span id="email" class="email"><a href="https://github.com/yermilov" target="_blank"><span class="icon"><i class="fa fa-github"></i></span> @yermilov</a> <a href="https://www.facebook.com/yaroslav.yermilov" target="_blank"><span class="icon"><i class="fa fa-facebook"></i></span> @yaroslav.yermilov</a> <a href="https://twitter.com/yermilov17" target="_blank"><span class="icon"><i class="fa fa-twitter"></i></span> @yermilov17</a></span><br>
<span id="revdate">2016-09-21</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#what_s_about_modern_unit_testing">2. What&#8217;s About Modern Unit Testing?</a>
<ul class="sectlevel2">
<li><a href="#junit_5">2.1. JUnit 5</a></li>
<li><a href="#testing_on_steroids">2.2. Testing on Steroids</a></li>
<li><a href="#spock">2.3. Spock</a></li>
</ul>
</li>
<li><a href="#why_try_spock">3. Why Try Spock?</a></li>
<li><a href="#how_to_start_with_spock">4. How To Start With Spock?</a></li>
<li><a href="#spock_assertions">5. Spock Assertions</a></li>
<li><a href="#test_structure">6. Test Structure</a></li>
<li><a href="#inner_test_structure">7. Inner Test Structure</a></li>
<li><a href="#data_driven_tests">8. Data Driven Tests</a></li>
<li><a href="#exceptions_handling">9. Exceptions Handling</a></li>
<li><a href="#mocking">10. Mocking</a>
<ul class="sectlevel2">
<li><a href="#stubs">10.1. Stubs</a></li>
<li><a href="#mocks">10.2. Mocks</a></li>
<li><a href="#spies">10.3. Spies</a></li>
<li><a href="#static_and_final_methods">10.4. Static and final methods</a></li>
</ul>
</li>
<li><a href="#timing_features">11. Timing features</a>
<ul class="sectlevel2">
<li><a href="#asserting_changes">11.1. Asserting changes</a></li>
<li><a href="#timeouts">11.2. Timeouts</a></li>
<li><a href="#testing_async_code">11.3. Testing async code</a></li>
</ul>
</li>
<li><a href="#test_execution_control">12. Test execution control</a>
<ul class="sectlevel2">
<li><a href="#disabling_tests">12.1. Disabling tests</a></li>
<li><a href="#test_suites">12.2. Test suites</a></li>
</ul>
</li>
<li><a href="#miscellanea">13. Miscellanea</a></li>
<li><a href="#geb">14. Geb</a></li>
<li><a href="#why_use_spock">15. Why Use Spock?</a></li>
<li><a href="#why_do_not_use_spock">16. Why Do Not Use Spock?</a></li>
<li><a href="#when_use_spock">17. When Use Spock?</a></li>
<li><a href="#looking_further">18. Looking Further</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this article we will try to examine current state of the automated testing concept in the Java world.
As a reference, we will go through basic and advanced spock-framework features and compare them with what JUnit4/JUnit5/TestNG/Hamcrest/AssertJ/Mockito/whatever can offer instead.
We will try to understand Spock philosophy and find out both pragmatic and emotional answer to the questions:
should I use spock-framework in the year of 2016?
how to convince my manager that "yes, we should"?
how to convince my teammates that "no, we shouldn&#8217;t"?</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what_s_about_modern_unit_testing">2. What&#8217;s About Modern Unit Testing?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To my mind, automated testing is one of the most powerful software development concept suggested so far.
After receiving great attention as part of XP manifesto, it made possible to increase size of projects and complexity of code we are able to maintain by orders of magnitude.</p>
</div>
<div class="paragraph">
<p><a href="http://junit.org/" target="_blank">JUnit</a>, started by Kent Beck and Erich Gamma, played key role in the development of the automated testing idea as it was one of the first ever and surely the most popular and influential automated testing library.</p>
</div>
<div class="paragraph">
<p><a href="http://testng.org/" target="_blank">TestNG</a>, started by Cédric Beust, was inspired by JUnit and initiated to offer wider and more powerful range of functionalities than JUnit originally does, keeping the same general concept. Later, most of the TestNG initiatives were implemented by JUnit.</p>
</div>
<div class="paragraph">
<p>As <a href="http://blog.takipi.com/the-top-100-java-libraries-in-2016-after-analyzing-47251-dependencies/" target="_blank">recent study</a> shows, JUnit is used by about amazingly 60% of Java projects and TestNG shows quite strong result of about 6%.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/spock-11ca2.png" alt="spock 11ca2">
</div>
<div class="title">Figure 1. Source: <a href="http://blog.takipi.com/the-top-100-java-libraries-in-2016-after-analyzing-47251-dependencies/" target="_blank">http://blog.takipi.com/the-top-100-java-libraries-in-2016-after-analyzing-47251-dependencies/</a></div>
</div>
<div class="paragraph">
<p>Both JUnit and TestNG shares the same framework architecture often called xUnit (surprisingly after SUnit and JUnit itself).
It&#8217;s described best by two concepts: test structure and assertions.
As test structure obviously is set of features to describe tests organization, and assertion is a function that verifies the behavior (or the state) of the unit under test.
If we look at the most simple JUnit and TestNG tests we will found them quite similarly implementing both concepts:</p>
</div>
<div class="listingblock">
<div class="title">Easy JUnit start</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.junit.Test</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert.assertEquals</span>;

    <span class="annotation">@Test</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="type">void</span> arrayList_length_ind() {
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt; list = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">we</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">all</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">love</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">junit</span><span class="delimiter">&quot;</span></span>);
        assertEquals(list.size(), <span class="integer">4</span>); <i class="conum" data-value="2"></i><b>(2)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Test structure</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assertion</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Easy TestNG start</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.testng.Assert.assertEquals</span>;

    <span class="annotation">@Test</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="type">void</span> arrayList_length_idm() {
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt; list = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">we</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">all</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">love</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">testng</span><span class="delimiter">&quot;</span></span>);
        assertEquals(list.size(), <span class="integer">4</span>); <i class="conum" data-value="2"></i><b>(2)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Test structure</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assertion</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Actually, except for import statements, these code snippets are the same.
My feel is that, not arguing with all benefits of JUnit and TestNG, they both were frozen long time ago and no longer evolving.
JUnit is ready to overcome this problem with 5.0.0 release, scheduled for the end of 2016.
Spock recently has epochal 1.0 release and 1.1 is on the way (1.1-rc2 version is already out).
TestNG has only several 6.9.x releases with no significant changes in them.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/article-034d5.png" alt="article 034d5">
</div>
</div>
<div class="paragraph">
<p>So, there are several possibilities for passionate developers to continue evolving their test automation instruments. Let&#8217;s examine them shortly.</p>
</div>
<div class="sect2">
<h3 id="junit_5">2.1. JUnit 5</h3>
<div class="paragraph">
<p>We can just wait until traditional tools will attempt to make revolutionary changes. Sounds not very promising, but sometimes miracles happen. <a href="http://junit.org/junit5/" target="_blank">JUnit 5</a> is on the way to final release after <a href="https://www.indiegogo.com/projects/junit-lambda#/" target="_blank">very successful crowdfunding campaign on Indiegogo</a>.</p>
</div>
<div class="paragraph">
<p>For now we can already examine second milestone release, and we can see that after a great work of JUnit team we will get a fresh new look at how JUnit should be implemented.
The most significant change is introduction of solid testing backend model, but it&#8217;s not a main topic of this article.
Let&#8217;s better check how the simplest JUnit 5 test looks like.
How many changes you can see?</p>
</div>
<div class="listingblock">
<div class="title">Easy JUnit 5 start</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertEquals</span>;

    <span class="annotation">@Test</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="type">void</span> arrayList_length_idm() {
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt; list = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">we</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">all</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">love</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">junit</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span>);
        assertEquals(<span class="integer">5</span>, list.size());  <i class="conum" data-value="2"></i><b>(2)</b> <i class="conum" data-value="3"></i><b>(3)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Test structure</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assertion</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Changes!</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="testing_on_steroids">2.2. Testing on Steroids</h3>
<div class="paragraph">
<p>We can use one of plenty libraries that boost test code quality: <a href="http://hamcrest.org/JavaHamcrest/" target="_blank">Hamcrest</a> (used by ~4% Java projects), <a href="http://joel-costigliola.github.io/assertj/" target="_blank">AssertJ</a> (used by ~3% Java projects), <a href="http://google.github.io/truth/" target="_blank">Google Truth</a> for assertions; <a href="http://mockito.org/" target="_blank">Mockito</a> (used by ~10% Java projects), <a href="https://github.com/jayway/powermock" target="_blank">PowerMock</a> (used by ~1.5% Java projects), <a href="http://jmockit.org/" target="_blank">JMockit</a>, <a href="http://easymock.org/" target="_blank">EasyMock</a> (used by ~3% Java projects) for mocking and stubbing and probably some others like <a href="https://github.com/spring-projects/spring-framework/tree/master/spring-test" target="_blank">Spring Test</a> (used by ~6% Java projects).</p>
</div>
<div class="paragraph">
<p>Actually I hope in the year 2016, no one is writing tests that looks like ones I&#8217;ve already shown.
As a base rule, they should be at least two steps forward: test should have clear inner structure and assertion should clearly explain its intent:</p>
</div>
<div class="listingblock">
<div class="title">Easy, but idiomatic JUnit start</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="type">void</span> arrayList_length_idm() {
        <span class="comment">// setup </span><i class="conum" data-value="2"></i><b>(2)</b>
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt; list = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

        <span class="comment">// run </span><i class="conum" data-value="2"></i><b>(2)</b>
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">we</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">all</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">love</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">junit</span><span class="delimiter">&quot;</span></span>);

        <span class="comment">// verify </span><i class="conum" data-value="2"></i><b>(2)</b>
        assertThat(list, hasSize(<span class="integer">4</span>)); <i class="conum" data-value="3"></i><b>(3)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Outer test structure</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inner test structure</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Assertion</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="spock">2.3. Spock</h3>
<div class="paragraph">
<p>Finally, we can make really big step forward and try completely new testing approach - <a href="http://docs.spockframework.org/" target="_blank">Spock</a> - test framework developed by Peter Niederwleser and Luke Daley.
Spock is greatly inspired by Groovy language philosophy and used Groovy dynamic nature a lot.
But the same as with Gradle, where you do not need to know Groovy to develop build scripts, here you need to know almost nothing about Groovy to use Spock.
If you treat Spock like separate test-specific language and learn its main concepts, you can easily use them in conjunction with plain old Java code.</p>
</div>
<div class="paragraph">
<p>As big steps are much more effective when they are done immediately, here is a very simple Spock test.
If you write tests that looks like the last example, it will be very simple for you to get what is going on there:</p>
</div>
<div class="listingblock">
<div class="title">Easy Spock start</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="type">class</span> <span class="class">N04S_EasyStart</span> <span class="directive">extends</span> Specification { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="keyword">def</span> <span class="function">arrayList_length</span>() { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="key">setup</span>: <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt; list = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

        <span class="key">when</span>: <i class="conum" data-value="2"></i><b>(2)</b>
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">we</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">will</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">love</span><span class="delimiter">&quot;</span></span>);
        list.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">spock</span><span class="delimiter">&quot;</span></span>);

        <span class="key">then</span>: <i class="conum" data-value="2"></i><b>(2)</b>
        assertThat(list, hasSize(<span class="integer">4</span>)); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Outer test structure</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inner test structure</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Assertion</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="why_try_spock">3. Why Try Spock?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Why someone should try to use Spock on their projects?
In the following sections I will demonstrate all benefits that can be gained from Spock usage.
Additionally, I will show drawbacks of such decision.
But despite both pros and cons there are two reasons why everyone should try Spock at least for their pet projects and later evaluate if it will be useful for the real ones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Spock is the next generation test framework</strong>. What does it mean? Spock takes all the years of automated testing experience and pain and re-imagine how it should be implemented if we look at it from a different angle.
<em>What if</em> we do not need to use the same language for testing as we use for production code?
<em>What if</em> it can be language designed for testing specifically?
<em>What if</em> test context can be moved from comments to code?
<em>What if</em> there are different testing approaches and we should offer convenient features for all of them?
Spock asks plenty of <em>What if?</em> questions and based on them re-implement well-known testing approach in another (arguably better) way.</p>
</li>
<li>
<p><strong>Spock is enterprise ready</strong>. Spock is more than 6 years old. Spock is already released 1.0 version and has stable API.
It&#8217;s completely mature framework that can be safely used without any fears.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how_to_start_with_spock">4. How To Start With Spock?</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/spock-8eb85.png" alt="spock 8eb85">
</div>
</div>
<div class="paragraph">
<p>As you can already see, it&#8217;s more than easy to start using Spock.
Begin with adding these three dependencies to your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">'</span><span class="content">org.spockframework:spock-core:1.1-groovy-2.4-rc-2</span><span class="delimiter">'</span></span>
<span class="string"><span class="delimiter">'</span><span class="content">cglib:cglib-nodep:3.2.2</span><span class="delimiter">'</span></span>
<span class="string"><span class="delimiter">'</span><span class="content">org.objenesis:objenesis:2.4</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you already have test code you want to migrate to Spock either from JUnit of TestNG take there five easy steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Rename your test files from <code>*.java</code> to <code>*.groovy</code> and move them to <code>src/test/groovy</code> directory.</p>
</li>
<li>
<p>Extend your test class form <code>spock.lang.Specification</code> class.</p>
</li>
<li>
<p>Remove all <code>@Test</code> annotations and change return type for all test methods to <code>def</code>.</p>
</li>
<li>
<p>Enforce inner test structure by using following labels: <code>setup</code> for test object setting up, <code>when</code> for test actions and <code>then</code> for assertions.</p>
</li>
<li>
<p>Enjoy becoming a Spock developer in less than 15 minutes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>However, if you are starting from scratch, you will probably want to write more idiomatic Spock code.
The first step towards this goal is start using Spock assertions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spock_assertions">5. Spock Assertions</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/spock-f1523.png" alt="spock f1523">
</div>
</div>
<div class="paragraph">
<p>In the first place, each test framework offers two simple assertion constructions: <code>assertEquals</code> checks for equality of two objects and <code>assertTrue</code> checks if specified expression is true. However, using such constructions has two critical drawbacks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when test fails, it&#8217;s hard to understand why it has failed;</p>
</li>
<li>
<p>test code is not maintainable, as it&#8217;s not obvious what was the intent behind each assertion.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Just try to look at following test failure logs and guess what is tested and why tests have failed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        assertEquals(list.size(), <span class="integer">3</span>);
<span class="comment">//        java.lang.AssertionError:</span>
<span class="comment">//        Expected :4</span>
<span class="comment">//        Actual   :3</span>

        assertTrue(list.size() == <span class="integer">3</span>);
<span class="comment">//        java.lang.AssertionError</span>
<span class="comment">//        at org.junit.Assert.fail(Assert.java:86)</span>
<span class="comment">//        at org.junit.Assert.assertTrue(Assert.java:41)</span>
<span class="comment">//        at org.junit.Assert.assertTrue(Assert.java:52)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s why it is so important to use external assertion library.
The most popular one, Hamcrest, clearly shows intent behind assertion both in the test code and in the failure message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.hasSize</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert.assertThat</span>

        assertThat(list, hasSize(<span class="integer">3</span>));
<span class="comment">//        java.lang.AssertionError:</span>
<span class="comment">//        Expected: a collection with size &lt;3&gt;</span>
<span class="comment">//        but: collection size was &lt;4&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Two libraries that are less popular, AssertJ and Google Truth, shows not only the assertion intent but also describe some part of the test context that lead to the failure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">com.google.common.truth.Truth</span>
<span class="keyword">import</span> <span class="include">org.assertj.core.api.Assertions</span>

        Assertions.assertThat(list).hasSize(<span class="integer">3</span>);
<span class="comment">//        java.lang.AssertionError:</span>
<span class="comment">//        Expected size:&lt;3&gt; but was:&lt;4&gt; in:</span>
<span class="comment">//        &lt;[&quot;we&quot;, &quot;will&quot;, &quot;love&quot;, &quot;spock&quot;]&gt;</span>

        Truth.assertThat(list).hasSize(<span class="integer">3</span>);
<span class="comment">//      java.lang.AssertionError: Not true that &lt;[we, will, love, spock]&gt; has a size of &lt;3&gt;. It is &lt;4&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Original Spock assertions show a little intent behind their code, but they are not less than perfect in demonstrating test context that lead to the failure. Moreover, all you need to start using them is to place boolean expression inside <code>then</code> block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">then</span>:
        list.size() == <span class="integer">3</span>
<span class="comment">//        Condition not satisfied:</span>
<span class="comment">//</span>
<span class="comment">//        list.size() == 3</span>
<span class="comment">//        |    |      |</span>
<span class="comment">//        |    4      false</span>
<span class="comment">//        [we, will, love, spock]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just look how useful they are when we need to examine some complex data flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/spock-4f14e.png" alt="spock 4f14e">
</div>
</div>
<div class="paragraph">
<p>But in combination with well-known Hamcrest matchers, Spock assertions provide 100% needed information from both test code and test failure reports:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">static</span> <span class="include">spock.util.matcher.HamcrestSupport.expect</span>

        <span class="key">then</span>:
        expect list, hasSize(<span class="integer">3</span>)
<span class="comment">//        Condition not satisfied:</span>
<span class="comment">//</span>
<span class="comment">//        expect list, hasSize(3)</span>
<span class="comment">//        |      |</span>
<span class="comment">//        false  [we, will, love, spock]</span>
<span class="comment">//</span>
<span class="comment">//        Expected: a collection with size &lt;3&gt;</span>
<span class="comment">//        but: collection size was &lt;4&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Spock assertions were so successful that they were ported to plain Groovy, which means that if you use JUnit or TestNG you can write you code in Groovy, immediatelly getting Spock assertions in your old-fashioned tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@Test</span>
    <span class="type">void</span> <span class="string"><span class="delimiter">'</span><span class="content">ArrayList.size()</span><span class="delimiter">'</span></span>() {
        <span class="comment">// setup</span>
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt; list = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;()

        <span class="comment">// run</span>
        list.add <span class="string"><span class="delimiter">'</span><span class="content">we</span><span class="delimiter">'</span></span>
        list.add <span class="string"><span class="delimiter">'</span><span class="content">will</span><span class="delimiter">'</span></span>
        list.add <span class="string"><span class="delimiter">'</span><span class="content">love</span><span class="delimiter">'</span></span>
        list.add <span class="string"><span class="delimiter">'</span><span class="content">spock</span><span class="delimiter">'</span></span>

        <span class="comment">// verify</span>
        <span class="keyword">assert</span> list.findAll({ <span class="local-variable">it</span>.length() &lt; <span class="integer">5</span> }) == list.drop(<span class="integer">2</span>)
<span class="comment">//        Assertion failed:</span>
<span class="comment">//</span>
<span class="comment">//        assert list.findAll({ it.length() &lt; 5 }) == list.drop(2)</span>
<span class="comment">//        |    |                            |  |    |</span>
<span class="comment">//        |    [we, will, love]             |  |    [love, spock]</span>
<span class="comment">//        [we, will, love, spock]           |  [we, will, love, spock]</span>
<span class="comment">//        false</span>
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test_structure">6. Test Structure</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/spock-f032e.png" alt="spock f032e">
</div>
</div>
<div class="paragraph">
<p>As it was already mentioned, the second main part of every testing framework is test structure toolset.
Traditional approach is pretty much the same:</p>
</div>
<div class="listingblock">
<div class="title">JUnit test structure toolset</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.junit.After</span>
<span class="keyword">import</span> <span class="include">org.junit.AfterClass</span>
<span class="keyword">import</span> <span class="include">org.junit.Before</span>
<span class="keyword">import</span> <span class="include">org.junit.BeforeClass</span>
<span class="keyword">import</span> <span class="include">org.junit.Test</span>

    <span class="directive">static</span> Sql sql <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@BeforeClass</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> createTable() {
        sql = Sql.newInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.h2.Driver</span><span class="delimiter">&quot;</span></span>)
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">create table testing_tool (id int primary key, name varchar(100), version varchar(100))</span><span class="delimiter">&quot;</span></span>)
    }

    <span class="annotation">@Before</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="type">void</span> insertBasicData() {
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into testing_tool values (1, 'junit', '4.12'), (2, 'spock', '1.0'), (3, 'testng', '6.9.10')</span><span class="delimiter">&quot;</span></span>)
    }

    <span class="annotation">@Test</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="directive">public</span> <span class="type">void</span> toolCount() {
        <span class="comment">// run</span>
        <span class="keyword">def</span> actual = sql.firstRow(<span class="string"><span class="delimiter">&quot;</span><span class="content">select count(*) as toolCount from testing_tool</span><span class="delimiter">&quot;</span></span>)

        <span class="comment">// verify</span>
        assertThat(actual.toolCount, is(<span class="integer">3L</span>))
    }

    <span class="annotation">@After</span> <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="directive">public</span> <span class="type">void</span> cleanTable() {
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">delete from testing_tool</span><span class="delimiter">&quot;</span></span>)
    }

    <span class="annotation">@AfterClass</span> <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> dropTable() {
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">drop table testing_tool</span><span class="delimiter">&quot;</span></span>)
        sql.close()
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Shared resource</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Executed once before all test cases</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Executed before each test case</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Test case</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Executed after each test case</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Executed once after all test cases</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">TestNG test structure toolset</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.testng.annotations.AfterClass</span>
<span class="keyword">import</span> <span class="include">org.testng.annotations.AfterMethod</span>
<span class="keyword">import</span> <span class="include">org.testng.annotations.BeforeClass</span>
<span class="keyword">import</span> <span class="include">org.testng.annotations.BeforeMethod</span>
<span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>

    <span class="directive">static</span> Sql sql <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@BeforeClass</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> createTable() {
        sql = Sql.newInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.h2.Driver</span><span class="delimiter">&quot;</span></span>)
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">create table testing_tool (id int primary key, name varchar(100), version varchar(100))</span><span class="delimiter">&quot;</span></span>)
    }

    <span class="annotation">@BeforeMethod</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="type">void</span> insertBasicData() {
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into testing_tool values (1, 'junit', '4.12'), (2, 'spock', '1.0'), (3, 'testng', '6.9.10')</span><span class="delimiter">&quot;</span></span>)
    }

    <span class="annotation">@Test</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="directive">public</span> <span class="type">void</span> toolCount() {
        <span class="comment">// run</span>
        <span class="keyword">def</span> actual = sql.firstRow(<span class="string"><span class="delimiter">&quot;</span><span class="content">select count(*) as toolCount from testing_tool</span><span class="delimiter">&quot;</span></span>)

        <span class="comment">// verify</span>
        assertEquals(actual.toolCount, <span class="integer">3L</span>)
    }

    <span class="annotation">@AfterMethod</span> <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="directive">public</span> <span class="type">void</span> cleanTable() {
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">delete from testing_tool</span><span class="delimiter">&quot;</span></span>)
    }

    <span class="annotation">@AfterClass</span> <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> dropTable() {
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">drop table testing_tool</span><span class="delimiter">&quot;</span></span>)
        sql.close()
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Shared resource</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Executed once before all test cases</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Executed before each test case</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Test case</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Executed after each test case</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Executed once after all test cases</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">JUnit 5 test structure toolset</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.junit.jupiter.api.AfterAll</span>
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.AfterEach</span>
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.BeforeAll</span>
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.BeforeEach</span>
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>

    <span class="directive">static</span> Sql sql

    <span class="annotation">@BeforeAll</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> createTable() {
        sql = Sql.newInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.h2.Driver</span><span class="delimiter">&quot;</span></span>)
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">create table testing_tool (id int primary key, name varchar(100), version varchar(100))</span><span class="delimiter">&quot;</span></span>)
    }

    <span class="annotation">@BeforeEach</span>
    <span class="directive">public</span> <span class="type">void</span> insertBasicData() {
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into testing_tool values (1, 'junit', '4.12'), (2, 'spock', '1.0'), (3, 'testng', '6.9.10')</span><span class="delimiter">&quot;</span></span>)
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> toolCount() {
        <span class="comment">// run</span>
        <span class="keyword">def</span> actual = sql.firstRow(<span class="string"><span class="delimiter">&quot;</span><span class="content">select count(*) as toolCount from testing_tool</span><span class="delimiter">&quot;</span></span>)

        <span class="comment">// verify</span>
        assertEquals(<span class="integer">3L</span>, actual.toolCount)
    }

    <span class="annotation">@AfterEach</span>
    <span class="directive">public</span> <span class="type">void</span> cleanTable() {
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">delete from testing_tool</span><span class="delimiter">&quot;</span></span>)
    }

    <span class="annotation">@AfterAll</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> dropTable() {
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">drop table testing_tool</span><span class="delimiter">&quot;</span></span>)
        sql.close()
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Shared resource</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Executed once before all test cases</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Executed before each test case</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Test case</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Executed after each test case</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Executed once after all test cases</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is one important thing about Spock philosophy as project.
<strong>If you do like traditional approach you can continue using it. Spock will just add some fancy Groovy magic to make it better</strong>.
In this concrete case, you can use <a href="http://docs.groovy-lang.org/next/html/documentation/core-traits.html" target="_blank">Groovy traits</a> to extract repeatable setup/cleanup behavior and reuse it easily across your test classes:</p>
</div>
<div class="listingblock">
<div class="title">Spock reusable test structure via traits</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">groovy.sql.Sql</span>

trait DatabaseSpec {

    <span class="directive">static</span> Sql sql <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="keyword">def</span> <span class="function">setupSpec</span>() { <i class="conum" data-value="2"></i><b>(2)</b>
        sql = Sql.newInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.h2.Driver</span><span class="delimiter">&quot;</span></span>)
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">create table testing_tool (id int primary key, name varchar(100), version varchar(100))</span><span class="delimiter">&quot;</span></span>)
    }

    <span class="keyword">def</span> <span class="function">setup</span>() { <i class="conum" data-value="3"></i><b>(3)</b>
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into testing_tool values (1, 'junit', '4.12'), (2, 'spock', '1.0'), (3, 'testng', '6.9.10')</span><span class="delimiter">&quot;</span></span>)
    }

    <span class="keyword">def</span> <span class="function">cleanup</span>() { <i class="conum" data-value="4"></i><b>(4)</b>
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">delete from testing_tool</span><span class="delimiter">&quot;</span></span>)
    }

    <span class="keyword">def</span> <span class="function">cleanupSpec</span>() { <i class="conum" data-value="5"></i><b>(5)</b>
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">drop table testing_tool</span><span class="delimiter">&quot;</span></span>)
        sql.close()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Shared resource</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Executed once before all test cases</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Executed before each test case</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Executed after each test case</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Executed once after all test cases</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To inject this behavior to your test specification, just implement all traits you need:</p>
</div>
<div class="listingblock">
<div class="title">Spock test structure toolset</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">N11S_SetupTeardown_AsYouLike</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> DatabaseSpec {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">tool count</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">we count number of unit testing tools</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> actual = sql.firstRow(<span class="string"><span class="delimiter">&quot;</span><span class="content">select count(*) as toolCount from testing_tool</span><span class="delimiter">&quot;</span></span>)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">it should be 3</span><span class="delimiter">'</span></span>
        actual.toolCount == <span class="integer">3</span>
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is one more important thing about Spock philosophy as project.
<strong>Spock always offers more!</strong>
Let&#8217;s examine the following:</p>
</div>
<div class="listingblock">
<div class="title">Spock more test structure toolset</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@Shared</span> <span class="annotation">@AutoCleanup</span> sql  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">JUnit5 is in game!</span><span class="delimiter">'</span></span>() {
        <span class="key">setup</span>: <span class="string"><span class="delimiter">'</span><span class="content">add JUnit 5 to the list of unit testing tools</span><span class="delimiter">'</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into testing_tool values (4, 'junit', '5')</span><span class="delimiter">&quot;</span></span>)

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">we count number of JUnits</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> actual = sql.firstRow(<span class="string"><span class="delimiter">&quot;</span><span class="content">select count(*) as toolCount from testing_tool where name = 'junit'</span><span class="delimiter">&quot;</span></span>)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">it should be 2</span><span class="delimiter">'</span></span>
        actual.toolCount == <span class="integer">2</span>

        <span class="key">cleanup</span>: <span class="string"><span class="delimiter">'</span><span class="content">remove JUnit 5 from the list of unit testing tools</span><span class="delimiter">'</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">delete from testing_tool where id = 4</span><span class="delimiter">&quot;</span></span>)
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Instead of using <code>static</code> keyword for shared resources use <code>@Shared</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@AutoCleanup</code> annotation invokes close method of the shared resource after each test case</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Tests can have individual setup blocks</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Tests can have individual cleanup blocks</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s look at <code>@Shared</code> annotation closely.
It will demonstrate why it&#8217;s so important to use test-specific language for your tests instead of general-purpose language like Java.
When you develop your test (but not only test) code, each time you try to find language feature that suites best your need.
For example, if you need to share some resource within test class and you use Java, natural choice will be <code>static</code>.
But, what if you want to do the same in several test classes? You can extract this behavior to superclass like following:</p>
</div>
<div class="listingblock">
<div class="title"><code>static</code> field for resource sharing</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">N14S_SharedExplained_BasicStatic</span> <span class="directive">extends</span> Specification {

    <span class="directive">static</span> <span class="predefined-type">List</span> arrayList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;()
}

<span class="annotation">@Stepwise</span>
<span class="type">class</span> <span class="class">N14S_SharedExplained_Static_1</span> <span class="directive">extends</span> N14S_SharedExplained_BasicStatic {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">static ArrayList and junit</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>:
        arrayList.add(<span class="string"><span class="delimiter">'</span><span class="content">junit</span><span class="delimiter">'</span></span>)

        <span class="key">then</span>:
        arrayList.size() == <span class="integer">1</span>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">static ArrayList and spock</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>:
        arrayList.add(<span class="string"><span class="delimiter">'</span><span class="content">spock</span><span class="delimiter">'</span></span>)

        <span class="key">then</span>:
        arrayList.size() == <span class="integer">2</span>
    }
}

<span class="type">class</span> <span class="class">N14S_SharedExplained_Static_2</span> <span class="directive">extends</span> N14S_SharedExplained_BasicStatic {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">static ArrayList and testng</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>:
        arrayList.add(<span class="string"><span class="delimiter">'</span><span class="content">junit</span><span class="delimiter">'</span></span>)

        <span class="key">then</span>:
        arrayList.size() == <span class="integer">1</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you look carefully, you will find that some of these tests will fail.
Single resource will be shared between all three test cases and you have no control over it.</p>
</div>
<div class="paragraph">
<p>Spock, as test-specific language, can keep in mind needs of test code developers and offer features that gives you more control on test code behavior.
In this example <code>@Shared</code> annotation clearly will share resource only within single specification. Our example is fixed:</p>
</div>
<div class="listingblock">
<div class="title"><code>@Shared</code> field for resource sharing</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">N14S_SharedExplained_BasicShared</span> <span class="directive">extends</span> Specification {

    <span class="annotation">@Shared</span> arrayList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;()
}

<span class="annotation">@Stepwise</span>
<span class="type">class</span> <span class="class">N14S_SharedExplained_Shared_1</span> <span class="directive">extends</span> N14S_SharedExplained_BasicShared {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">shared ArrayList and junit</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>:
        arrayList.add(<span class="string"><span class="delimiter">'</span><span class="content">junit</span><span class="delimiter">'</span></span>)

        <span class="key">then</span>:
        arrayList.size() == <span class="integer">1</span>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">shared ArrayList and spock</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>:
        arrayList.add(<span class="string"><span class="delimiter">'</span><span class="content">spock</span><span class="delimiter">'</span></span>)

        <span class="key">then</span>:
        arrayList.size() == <span class="integer">2</span>
    }
}

<span class="type">class</span> <span class="class">N14S_SharedExplained_Shared_2</span> <span class="directive">extends</span> N14S_SharedExplained_BasicShared {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">shared ArrayList and testng</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>:
        arrayList.add(<span class="string"><span class="delimiter">'</span><span class="content">junit</span><span class="delimiter">'</span></span>)

        <span class="key">then</span>:
        arrayList.size() == <span class="integer">1</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="inner_test_structure">7. Inner Test Structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To my mind, the most important Spock feature comparing to other test frameworks (that do not have anything similar) is <strong>enforcing inner test structure</strong>.
While it&#8217;s generally a good practice to set up inner test structure using comments, Spock provides language features that make you do it.
It&#8217;s really great design decision, because comments, as they are not natural part of the code, becomes outdated very quickly.
When something is part of the code, it is always up to date.
Let&#8217;s look at the example:</p>
</div>
<div class="listingblock">
<div class="title">Spock inner test structure</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">spock.lang.Issue</span>
<span class="keyword">import</span> <span class="include">spock.lang.Narrative</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="keyword">import</span> <span class="include">spock.lang.Subject</span>
<span class="keyword">import</span> <span class="include">spock.lang.Title</span>

<span class="annotation">@Title</span>(<span class="string"><span class="delimiter">'</span><span class="content">ArrayList tests</span><span class="delimiter">'</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Narrative</span>(<span class="string"><span class="delimiter">'''</span><span class="content">
As Java developer
(that trust nothing)
I want to be sure ArrayList works
</span><span class="delimiter">'''</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@Report</span>
<span class="type">class</span> <span class="class">N07S_IdiomaticSpock</span> <span class="directive">extends</span> Specification {

    <span class="annotation">@Subject</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt; list

    <span class="annotation">@Issue</span>(<span class="string"><span class="delimiter">'</span><span class="content">https://github.com/yermilov/spock-talk/issues/1</span><span class="delimiter">'</span></span>) <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">ArrayList.size()</span><span class="delimiter">'</span></span>() {
        <span class="key">setup</span>: <span class="string"><span class="delimiter">'</span><span class="content">new ArrayList instance</span><span class="delimiter">'</span></span> <i class="conum" data-value="5"></i><b>(5)</b>
        list = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;()

        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">that newly created ArrayList instance is empty</span><span class="delimiter">'</span></span> <i class="conum" data-value="6"></i><b>(6)</b>
        list.empty

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">add value to list</span><span class="delimiter">'</span></span> <i class="conum" data-value="7"></i><b>(7)</b>
        list.add <span class="string"><span class="delimiter">'</span><span class="content">we</span><span class="delimiter">'</span></span>

        <span class="key">and</span>: <span class="string"><span class="delimiter">'</span><span class="content">add one more value to list</span><span class="delimiter">'</span></span> <i class="conum" data-value="8"></i><b>(8)</b>
        list.add <span class="string"><span class="delimiter">'</span><span class="content">will</span><span class="delimiter">'</span></span>

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">array list size should be 2</span><span class="delimiter">'</span></span> <i class="conum" data-value="9"></i><b>(9)</b>
        list.size() == <span class="integer">2</span>

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">add two more values into list</span><span class="delimiter">'</span></span>
        list.add <span class="string"><span class="delimiter">'</span><span class="content">love</span><span class="delimiter">'</span></span>
        list.add <span class="string"><span class="delimiter">'</span><span class="content">spock</span><span class="delimiter">'</span></span>

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">array list size should be 4</span><span class="delimiter">'</span></span>
        list.size() == <span class="integer">4</span>

        <span class="key">and</span>: <span class="string"><span class="delimiter">'</span><span class="content">list contains all needed values</span><span class="delimiter">'</span></span>
        list == [ <span class="string"><span class="delimiter">'</span><span class="content">we</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">will</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">love</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">spock</span><span class="delimiter">'</span></span> ]
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Title gives short name of what is going on within this test suite</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Narrative is the text describing specification</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Subject points on object under test</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Issue describes issues connected with the test case</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You are already familiar with <code>setup</code> block, but pay attention on string (not comment!) that follows each test block describing what is going on inside it</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>expect</code> block contains set of conditions that all should evaluate to <code>true</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>when</code> block contains set of actions on object under test</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><code>and</code> block helps to split sets under <code>when</code> or <code>then</code> blocks</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td><code>then</code> block contains set of conditions that all should evaluate to <code>true</code> after previous <code>when</code> block</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Great follow-up from the fact that test structure becomes part of the test code is that this information becomes available at runtime.
Projects like <a href="https://github.com/renatoathaydes/spock-reports" target="_blank">Spock reports</a> leverage this information and, for example, generate very detailed reports based on it.
Just look at test report that is ready to publish for your team non-development folks:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/spock-f353a.png" alt="spock f353a">
</div>
</div>
<div class="paragraph">
<p>All you need to do is add following code to your build file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testCompile(<span class="string"><span class="delimiter">'</span><span class="content">com.athaydes:spock-reports:1.2.10</span><span class="delimiter">'</span></span>) {
    transitive = <span class="predefined-constant">false</span> <span class="comment">// this avoids affecting your version of Groovy/Spock</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data_driven_tests">8. Data Driven Tests</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/spock-b7d45.png" alt="spock b7d45">
</div>
</div>
<div class="paragraph">
<p>To my mind, while the previous feature is greatest and the most unappreciated Spock feature, this one is the most famed one.
Surely, it&#8217;s very powerful, but it&#8217;s needed only for some specific cases, while inner test structure is generally applicable.
I&#8217;m talking about data driven tests. Let&#8217;s look at quick example:</p>
</div>
<div class="listingblock">
<div class="title">Complex data driven test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">is coin flip good enough for determine if integer is prime</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">we flip a coin</span><span class="delimiter">'</span></span>
        <span class="type">boolean</span> coinFlip = <span class="keyword">new</span> <span class="predefined-type">Random</span>().nextBoolean()

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">it will be great if coin flip predict if number is prime</span><span class="delimiter">'</span></span>
        (number % <span class="integer">2</span> == <span class="integer">0</span> ? <span class="predefined-constant">false</span> : coinFlip) == expectedAnswer <i class="conum" data-value="4"></i><b>(4)</b>

        <span class="key">where</span>: <span class="string"><span class="delimiter">'</span><span class="content">data is random</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
        number &lt;&lt; (<span class="integer">1</span>..<span class="integer">5</span>).collect({ <span class="keyword">new</span> <span class="predefined-type">Random</span>().nextInt(<span class="integer">1000</span>) }).findAll({ <span class="local-variable">it</span> &gt;= <span class="integer">2</span> }).sort() <i class="conum" data-value="2"></i><b>(2)</b>
        expectedAnswer = Primes.isPrime(number) <i class="conum" data-value="3"></i><b>(3)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>where</code> is new test block used for defining variables that work as multiple test parameters for same test scenario</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Test parameter can be defined as collection of values</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Or just as assignment rule</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Defined test parameters can be used as regular variables inside other test blocks</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example shows <em>complex</em> test case, when the same scenario is run against multiple test parameters within same equivalence class.
Test is considered as passed if and only if test scenario passes all test parameters.
Here is how test report looks for this case:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/spock-1dd56.png" alt="spock 1dd56">
</div>
</div>
<div class="paragraph">
<p>Another use case supported by Spock is reusing same test code for test cases from different equivalence class.
Here is example that demonstrate this and some other concepts:</p>
</div>
<div class="listingblock">
<div class="title">Dividual data driven test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@Unroll</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">calculate runner speed and location after some time for #description</span><span class="delimiter">'</span></span>() { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">that runner speed is equal to expected</span><span class="delimiter">'</span></span>
        speed0 + accl * time == speed1

        <span class="key">and</span>: <span class="string"><span class="delimiter">'</span><span class="content">runner location is equal to expected</span><span class="delimiter">'</span></span>
        coord0 + time * (speed0 + accl / <span class="integer">2</span> * time) == coord1

        <span class="key">where</span>: <span class="string"><span class="delimiter">'</span><span class="content">there are set of precalculated data for different situations</span><span class="delimiter">'</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
        coord0 | speed0 | accl | time || coord1 | speed1 || description
        <span class="integer">0</span>      | <span class="integer">6</span>      | <span class="integer">0</span>    | <span class="integer">10</span>   || <span class="integer">60</span>     | <span class="integer">6</span>      || <span class="string"><span class="delimiter">'</span><span class="content">steady run from starting point</span><span class="delimiter">'</span></span>
        <span class="integer">5</span>      | <span class="integer">0</span>      | <span class="integer">3</span>    | <span class="integer">3</span>    || <span class="integer">17</span>     | <span class="integer">9</span>      || <span class="string"><span class="delimiter">'</span><span class="content">start from still with acceleration</span><span class="delimiter">'</span></span>
        -<span class="integer">50</span>    | <span class="integer">10</span>     | -<span class="integer">1</span>   | <span class="integer">10</span>   || <span class="integer">0</span>      | <span class="integer">0</span>      || <span class="string"><span class="delimiter">'</span><span class="content">constant deceleration</span><span class="delimiter">'</span></span>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@Unroll</code> annotation turns complex test case into dividual one</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>test parameters can be used inside test name with <code>#</code> mark</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>test parameters can be organized into fancy tables</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example shows <em>dividual</em> test cases, when test representation is separated from test code.
Each test parameter generate individual test case, that shares the same code, but not test result, with others.
Here is how test report looks for this case:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/spock-997c6.png" alt="spock 997c6">
</div>
</div>
<div class="paragraph">
<p>Traditional test frameworks mix up both concepts, and moreover provide very poor language support for data-driven test:</p>
</div>
<div class="listingblock">
<div class="title">JUnit data driven test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Parameterized.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">N16J_DataProviders</span> {

    <span class="annotation">@Parameterized</span>.Parameters(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">calc runner speed and location after some time for {6}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; data() {
        <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(<span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span><span class="type">[]</span> {
            { <span class="float">0.0</span>,   <span class="float">6.0</span>,  <span class="float">0.0</span>,  <span class="float">10.0</span>, <span class="float">60.0</span>, <span class="float">6.0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">steady run from starting point</span><span class="delimiter">&quot;</span></span> },
            { <span class="float">5.0</span>,   <span class="float">0.0</span>,  <span class="float">3.0</span>,  <span class="float">3.0</span>,  <span class="float">17.0</span>, <span class="float">9.0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">starting from standing with acceleration</span><span class="delimiter">&quot;</span></span> },
            { -<span class="float">50.0</span>, <span class="float">10.0</span>, -<span class="float">1.0</span>, <span class="float">10.0</span>, <span class="float">0.0</span>,  <span class="float">0.0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">constant deceleration</span><span class="delimiter">&quot;</span></span>}
        });
    }

    <span class="annotation">@Parameterized</span>.Parameter(value = <span class="integer">0</span>)
    <span class="directive">public</span> <span class="type">double</span> initialLocation;

    <span class="annotation">@Parameterized</span>.Parameter(value = <span class="integer">1</span>)
    <span class="directive">public</span> <span class="type">double</span> initialSpeed;

    <span class="annotation">@Parameterized</span>.Parameter(value = <span class="integer">2</span>)
    <span class="directive">public</span> <span class="type">double</span> acceleration;

    <span class="annotation">@Parameterized</span>.Parameter(value = <span class="integer">3</span>)
    <span class="directive">public</span> <span class="type">double</span> time;

    <span class="annotation">@Parameterized</span>.Parameter(value = <span class="integer">4</span>)
    <span class="directive">public</span> <span class="type">double</span> expectedLocation;

    <span class="annotation">@Parameterized</span>.Parameter(value = <span class="integer">5</span>)
    <span class="directive">public</span> <span class="type">double</span> expectedSpeed;

    <span class="annotation">@Parameterized</span>.Parameter(value = <span class="integer">6</span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> description;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> speed() {
        <span class="type">double</span> speed = initialSpeed + acceleration * time;
        assertThat(speed, is(equalTo(expectedSpeed)));
    }</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/spock-b408e.png" alt="spock b408e">
</div>
</div>
<div class="listingblock">
<div class="title">TestNG data driven test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@DataProvider</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">Object</span><span class="type">[]</span><span class="type">[]</span> data() {
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span><span class="type">[]</span> {
            { <span class="float">0.0</span>,   <span class="float">6.0</span>,  <span class="float">0.0</span>,  <span class="float">10.0</span>, <span class="float">60.0</span>, <span class="float">6.0</span> },
            { <span class="float">5.0</span>,   <span class="float">0.0</span>,  <span class="float">3.0</span>,  <span class="float">3.0</span>,  <span class="float">17.0</span>, <span class="float">9.0</span> },
            { -<span class="float">50.0</span>, <span class="float">10.0</span>, -<span class="float">1.0</span>, <span class="float">10.0</span>, <span class="float">0.0</span>,  <span class="float">0.0</span> }
        };
    }

    <span class="annotation">@Test</span>(dataProvider = <span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> speed(<span class="type">double</span> initialLocation, <span class="type">double</span> initialSpeed, <span class="type">double</span> acceleration, <span class="type">double</span> time, <span class="type">double</span> expectedLocation, <span class="type">double</span> expectedSpeed) {
        <span class="type">double</span> speed = initialSpeed + acceleration * time;
        assertEquals(speed, expectedSpeed);
    }</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/spock-25dc5.png" alt="spock 25dc5">
</div>
</div>
<div class="paragraph">
<p>Pay attention that using <code>Object[][]</code> is very unsafe and unclear for test parameters set up, and even more, that TestNG does not supports test naming easily.</p>
</div>
<div class="paragraph">
<p>What is interesting, JUnit 5 instead of having concept of data-driven tests, has more general and very powerful concept of dynamic tests.
It means that test cases can be generated at runtime, based on provided data and any other source:</p>
</div>
<div class="listingblock">
<div class="title">JUnit 5 dynamic test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Object</span><span class="type">[]</span><span class="type">[]</span> DATA = <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span><span class="type">[]</span> {
            { <span class="float">0.0</span>,   <span class="float">6.0</span>,  <span class="float">0.0</span>,  <span class="float">10.0</span>, <span class="float">60.0</span>, <span class="float">6.0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">steady run from starting point</span><span class="delimiter">&quot;</span></span> },
            { <span class="float">5.0</span>,   <span class="float">0.0</span>,  <span class="float">3.0</span>,  <span class="float">3.0</span>,  <span class="float">17.0</span>, <span class="float">9.0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">starting from standing with acceleration</span><span class="delimiter">&quot;</span></span> },
            { -<span class="float">50.0</span>, <span class="float">10.0</span>, -<span class="float">1.0</span>, <span class="float">10.0</span>, <span class="float">0.0</span>,  <span class="float">0.0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">constant deceleration</span><span class="delimiter">&quot;</span></span>}
    };

    <span class="annotation">@TestFactory</span>
    <span class="directive">public</span> Stream&lt;DynamicTest&gt; speedTests() {
        <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.stream(DATA).map(data -&gt; dynamicTest(data[<span class="integer">6</span>].toString(), () -&gt; {
            <span class="type">double</span> initialSpeed = (<span class="type">double</span>) data[<span class="integer">1</span>];
            <span class="type">double</span> acceleration = (<span class="type">double</span>) data[<span class="integer">2</span>];
            <span class="type">double</span> time = (<span class="type">double</span>) data[<span class="integer">3</span>];
            <span class="type">double</span> expectedSpeed = (<span class="type">double</span>) data[<span class="integer">5</span>];

            <span class="type">double</span> speed = initialSpeed + acceleration * time;
            assertEquals(expectedSpeed, speed);
        }));
    }</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/article-549aa.png" alt="article 549aa">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exceptions_handling">9. Exceptions Handling</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/spock-aafec.png" alt="spock aafec">
</div>
</div>
<div class="paragraph">
<p>When you want to have a test case checking that exception is thrown for some particular scenario in your JUnit test suite, it is as easy as defining simple <code>@Test</code> parameter:</p>
</div>
<div class="listingblock">
<div class="title">JUnit simple thrown exception check</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>(expected = <span class="exception">IndexOutOfBoundsException</span>.class)
    <span class="directive">public</span> <span class="type">void</span> exception_oldWay() {
        <span class="comment">// setup</span>
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">Integer</span>&gt; arrayList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

        <span class="comment">// run</span>
        arrayList.get(<span class="integer">17</span>);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thing become a little harder when you need to perform some additional checks, like exception message or stack trace:</p>
</div>
<div class="listingblock">
<div class="title">JUnit simple thrown exception message check</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> exceptionAndMessage_oldWay() {
        <span class="comment">// setup</span>
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">Integer</span>&gt; arrayList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

        <span class="comment">// run</span>
        <span class="keyword">try</span> {
            arrayList.get(<span class="integer">17</span>);
            fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">Expected an IndexOutOfBoundsException to be thrown</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">catch</span> (<span class="exception">IndexOutOfBoundsException</span> exception) {
            <span class="comment">// verify</span>
            assertThat(exception.getMessage(), is(<span class="string"><span class="delimiter">&quot;</span><span class="content">Index: 17, Size: 0</span><span class="delimiter">&quot;</span></span>));
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For both cases, Spock comes up with a very convenient way to catch thrown exception and do whatever you want to do with and check whatever you want to check:</p>
</div>
<div class="listingblock">
<div class="title">Spock thrown exception check</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">empty ArrayList has no 17th element</span><span class="delimiter">'</span></span>() {
        <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">empty array list</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> arrayList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">Integer</span>&gt;()

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">we try to retrieve element with index #17</span><span class="delimiter">'</span></span>
        arrayList.get(<span class="integer">17</span>)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">exception is thrown with expected message</span><span class="delimiter">'</span></span>
        <span class="exception">IndexOutOfBoundsException</span> exception = thrown()
        exception.message == <span class="string"><span class="delimiter">'</span><span class="content">Index: 17, Size: 0</span><span class="delimiter">'</span></span>
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>But what if you want to check that after some action exception was <em>not</em> thrown?
The most simple way is just do nothing, as unexpected exception will cause test to fail:</p>
</div>
<div class="listingblock">
<div class="title">JUnit simple not-thrown exception check</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> noException_oldWay() {
        <span class="comment">// setup</span>
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">Integer</span>&gt; arrayList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

        <span class="comment">// run</span>
        arrayList.size();

        <span class="comment">// verify no exception is thrown</span>
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The problem with such approach is that if exception is <em>do</em> thrown test will be marked not as <em>failed</em> but as <em>error</em>.
If you do not like it, you should do something like:</p>
</div>
<div class="listingblock">
<div class="title">JUnit ugly not-thrown exception check</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> noException_uglyWay() {
        <span class="comment">// setup</span>
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">Integer</span>&gt; arrayList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

        <span class="comment">// run</span>
        <span class="keyword">try</span> {
            arrayList.size();
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> exception) {
            <span class="comment">// verify no exception is thrown</span>
            fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">Expected no exception to be thrown</span><span class="delimiter">&quot;</span></span>);
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>What Spock do is, again, come up with very convenient way to declare that test intent is that exception should not be thrown.
Pay attention that it&#8217;s done not through comment, but rather with language construction:</p>
</div>
<div class="listingblock">
<div class="title">Spock not-thrown exception check</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">large ArrayList has 17th element</span><span class="delimiter">'</span></span>() {
        <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">list of 28 prime numbers</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> arrayList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">Integer</span>&gt;()
        <span class="integer">28</span>.times { arrayList &lt;&lt; Primes.nextPrime(arrayList.empty ? <span class="integer">1</span> : arrayList[-<span class="integer">1</span>]) }

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">we try to retrieve element with index #17</span><span class="delimiter">'</span></span>
        arrayList.get(<span class="integer">17</span>)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">no exception is thrown</span><span class="delimiter">'</span></span>
        notThrown(<span class="exception">IndexOutOfBoundsException</span>)
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, if you are familiar with <a href="https://github.com/junit-team/junit4/wiki/Rules" target="_blank">JUnit Rules API</a>, you surely can greatly improve JUnit solution:</p>
</div>
<div class="listingblock">
<div class="title">JUnit thrown exception check via Rules API</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Rule</span>
    <span class="directive">public</span> ExpectedException thrown = ExpectedException.none();


    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> exception_modernWay() {
        <span class="comment">// setup</span>
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">Integer</span>&gt; arrayList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

        <span class="comment">// expect</span>
        thrown.expect(<span class="exception">IndexOutOfBoundsException</span>.class);
        thrown.expectMessage(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">Index: 17, Size: 0</span><span class="delimiter">&quot;</span></span>));

        <span class="comment">// run</span>
        arrayList.get(<span class="integer">17</span>);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>JUnit 5 can do the same natively:</p>
</div>
<div class="listingblock">
<div class="title">JUnit 5 thrown exception check</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> exception() {
        <span class="comment">// setup</span>
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">Integer</span>&gt; arrayList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

        <span class="comment">// run &amp; verify</span>
        <span class="predefined-type">Throwable</span> thrown = expectThrows(<span class="exception">IndexOutOfBoundsException</span>.class, () -&gt; { arrayList.get(<span class="integer">17</span>); });
        assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Index: 17, Size: 0</span><span class="delimiter">&quot;</span></span>, thrown.getMessage());
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>What is very disappointing is that TestNG has a very limited, closed and ugly solution for the same problem.
If you want to check exception error message, you should supply expected regexp to <code>@Test</code> annotation:</p>
</div>
<div class="listingblock">
<div class="title">TestNG thrown exception check</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>(expectedExceptions = <span class="exception">IndexOutOfBoundsException</span>.class, expectedExceptionsMessageRegExp = <span class="string"><span class="delimiter">&quot;</span><span class="content">Index: 17, Size: 0</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> exception_oldWay() {
        <span class="comment">// setup</span>
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">Integer</span>&gt; arrayList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

        <span class="comment">// run</span>
        arrayList.get(<span class="integer">17</span>);
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mocking">10. Mocking</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/spock-1abd2.png" alt="spock 1abd2">
</div>
</div>
<div class="paragraph">
<p>As you probably already notice from the study shown at the beginning, industry standard de facto for all mocking activities is Mockito library.
As usual, if you like it (and probably you do), you can continue using it with Spock.
And again Spock offers you its own solution which uses fancy Groovy magic to make mocking more pleasant for developers.</p>
</div>
<div class="paragraph">
<p>By the way, providing all needed functionality for any kind of testing approach is a great part of Spock philosophy, which is clearly shown by this example.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s now exam and compare Mockito and Spock solutions for various mocking tasks one by one:</p>
</div>
<div class="sect2">
<h3 id="stubs">10.1. Stubs</h3>
<div class="paragraph">
<p>Stubs are used when you need to replace some complex behavior of units you depends on by simple one, like returning constant value or throwing exception.</p>
</div>
<div class="listingblock">
<div class="title">Make stub to return value via Mockito</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">random generator that always return 0</span><span class="delimiter">'</span></span>
        <span class="predefined-type">Random</span> random = mock(<span class="predefined-type">Random</span>)
        doReturn(<span class="integer">0</span>).when(random).nextInt(<span class="integer">26</span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Make stub to return value via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">random generator that always return 0</span><span class="delimiter">'</span></span>
        <span class="predefined-type">Random</span> random = <span class="predefined-type">Stub</span>()
        random.nextInt(<span class="integer">26</span>) &gt;&gt; <span class="integer">0</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Make stub to return consequent values via Mockito</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">random generator that always return predefined values</span><span class="delimiter">'</span></span>
        <span class="predefined-type">Random</span> random = mock(<span class="predefined-type">Random</span>)
        doReturn(<span class="integer">0</span>).doReturn(<span class="integer">1</span>).doReturn(<span class="integer">2</span>).doReturn(<span class="integer">3</span>).doReturn(<span class="integer">4</span>).when(random).nextInt(<span class="integer">26</span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Make stub to return consequent values via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">random generator that always return predefined values</span><span class="delimiter">'</span></span>
        <span class="predefined-type">Random</span> random = <span class="predefined-type">Stub</span>()
        random.nextInt(_) &gt;&gt;&gt; [ <span class="integer">0</span>, <span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">4</span> ]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Make stub to throw exception via Mockito</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">random generator that always throw exception</span><span class="delimiter">'</span></span>
        <span class="predefined-type">Random</span> random = mock(<span class="predefined-type">Random</span>)
        doThrow(<span class="keyword">new</span> <span class="exception">RuntimeException</span>()).when(random).nextInt(<span class="integer">26</span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Make stub to throw exception via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">random generator that always throw exception</span><span class="delimiter">'</span></span>
        <span class="predefined-type">Random</span> random = <span class="predefined-type">Stub</span>()
        random.nextInt(_) &gt;&gt; { <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>() }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Make stub to perform some custom action via Mockito</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">random generator that always return biggest possible value</span><span class="delimiter">'</span></span>
        <span class="predefined-type">Random</span> random = mock(<span class="predefined-type">Random</span>)
        doAnswer({ inv -&gt; (<span class="type">int</span>) inv.getArguments()[<span class="integer">0</span>] - <span class="integer">1</span>}).when(random).nextInt(<span class="integer">26</span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Make stub to perform some custom action via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">random generator that always return biggest possible value</span><span class="delimiter">'</span></span>
        <span class="predefined-type">Random</span> random = <span class="predefined-type">Stub</span>()
        random.nextInt(_) &gt;&gt; { <span class="type">int</span> max -&gt; max - <span class="integer">1</span> }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mocks">10.2. Mocks</h3>
<div class="paragraph">
<p>Mocks are used when you need to monitor and verify interactions with units you depends on.</p>
</div>
<div class="listingblock">
<div class="title">Simple check how many times specified method was invoked via Mockito</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">random generator is invoked 5 times</span><span class="delimiter">'</span></span>
        mockito verify(random, times(<span class="integer">5</span>)).nextInt(anyInt())</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Simple check how many times specified method was invoked via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">random generator is invoked 5 times</span><span class="delimiter">'</span></span>
        <span class="integer">5</span> * random.nextInt(_)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">More complex mocks verifications and order check via Mockito</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">then</span>: <span class="string"><span class="delimiter">'''</span><span class="content">first random generator is invoked once to generate password length,
                 then at least 8 times more and it is never invoked for anything else</span><span class="delimiter">'''</span></span>
        InOrder inOrder = inOrder(random)
        mockito inOrder.verify(random, times(<span class="integer">1</span>)).nextInt(<span class="integer">10</span>)
        mockito inOrder.verify(random, atLeast(<span class="integer">8</span>)).nextInt(<span class="integer">26</span>)
        mockito inOrder.verifyNoMoreInteractions()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">More complex mocks verifications and order check via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">first random generator is invoked once to generate password length</span><span class="delimiter">'</span></span>
        <span class="integer">1</span> * random.nextInt(<span class="integer">10</span>)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">then random generator is invoked at least 8 times more</span><span class="delimiter">'</span></span>
        (<span class="integer">8</span>.._) * random.nextInt(_)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">random generator is never invoked for anything else</span><span class="delimiter">'</span></span>
        <span class="integer">0</span> * random._</code></pre>
</div>
</div>
<div class="paragraph">
<p>One small detail is that for using Mockito invocations inside <code>then</code> block you need to make them always return true, because as failure is signaled by throwing exceptions, Spock can misinterpret value returned by Mockito.
This issue is simply fixed by adding following method to your specifications:</p>
</div>
<div class="listingblock">
<div class="title">Just use <code>mockito {mockitoMethod}</code> for all Mockito interactions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="directive">static</span> <span class="keyword">def</span> <span class="function">mockito</span>(<span class="keyword">def</span> verify) {
        <span class="predefined-constant">true</span>
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spies">10.3. Spies</h3>
<div class="paragraph">
<p>Spies are used when you need to monitor and verify interactions with unit you are testing.
The difference is that mocks are used to fake unit behavior and monitor its usage, while spies monitors without changing original behavior.</p>
</div>
<div class="listingblock">
<div class="title">Check method arguments values via Mockito</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        ArgumentCaptor&lt;<span class="predefined-type">Integer</span>&gt; argument = ArgumentCaptor.forClass(<span class="predefined-type">Integer</span>.class);
        verify(passwordGenerator).generate(argument.capture());
        assertThat(argument.getValue(), is(greaterThanOrEqualTo(<span class="integer">8</span>)));
        assertThat(argument.getValue(), is(lessThan(<span class="integer">18</span>)));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Check method arguments values via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">it tries to generate password of length from 8 to 17</span><span class="delimiter">'</span></span>
        <span class="integer">1</span> * passwordGenerator.generate({ <span class="local-variable">it</span> &gt;= <span class="integer">8</span> &amp;&amp; <span class="local-variable">it</span> &lt; <span class="integer">18</span> })</code></pre>
</div>
</div>
<div class="paragraph">
<p>As Spock is used for testing Groovy code, which is dynamic, some available checks have a little sense for Java and Mockito:</p>
</div>
<div class="listingblock">
<div class="title">Check that method argument is not <code>null</code> via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">it tries to generate password of some not-null length</span><span class="delimiter">'</span></span>
        <span class="integer">1</span> * passwordGenerator.generate(!<span class="predefined-constant">null</span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Check method argument type via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">it tries to generate password of some integer length</span><span class="delimiter">'</span></span>
        <span class="integer">1</span> * passwordGenerator.generate(_ <span class="keyword">as</span> <span class="predefined-type">Integer</span>)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="static_and_final_methods">10.4. Static and final methods</h3>
<div class="paragraph">
<p>Besides traditional and best-practice features, Spock offers more.
Yes, they are bad practices, but who lives in ideal world?
If needed you can stub, mock or spy on <code>static</code> and/or <code>final</code> methods:</p>
</div>
<div class="listingblock">
<div class="title">Spying on <code>static final</code> method via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">static final mocking</span><span class="delimiter">'</span></span>() {
        <span class="key">given</span>: <span class="string"><span class="delimiter">'</span><span class="content">we can mock *static* method of *final* class java.lang.Math</span><span class="delimiter">'</span></span>
        GroovySpy(<span class="predefined-type">Math</span>, <span class="key">global</span>: <span class="predefined-constant">true</span>)
        <span class="integer">1</span> * <span class="predefined-type">Math</span>.abs(_) &gt;&gt; <span class="integer">28</span>

        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">a miracle happens</span><span class="delimiter">'</span></span>
        <span class="predefined-type">Math</span>.abs(<span class="integer">17</span>) == <span class="integer">28</span>
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>With great power comes great responsibility</em> is a very good citation for this case.</p>
</div>
<div class="paragraph">
<p>Given a very concise mocking syntax in Spock, another citation is also very good to remember:</p>
</div>
<div class="listingblock">
<div class="title">Valid Spock code, ladies and gentlemen!</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">syntax bomb</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">mocking goes to far</span><span class="delimiter">'</span></span>
        Mock(<span class="predefined-type">Random</span>)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'''</span><span class="content">that guy who ends up maintaining
                 your code will be a violent psychopath
                 who knows where you live</span><span class="delimiter">'''</span></span>
        (_.._) * _.(_) &gt;&gt; _
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="timing_features">11. Timing features</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/spock-4bf7a.png" alt="spock 4bf7a">
</div>
</div>
<div class="sect2">
<h3 id="asserting_changes">11.1. Asserting changes</h3>
<div class="paragraph">
<p>If you need to check how some value has changed after execution of test scenario, traditional and reasonable approach is to save it before and after execution to compare afterwards:</p>
</div>
<div class="listingblock">
<div class="title">Asserting changes without Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> <span class="string"><span class="delimiter">'</span><span class="content">modifying data in table</span><span class="delimiter">'</span></span>() {
        <span class="comment">// run</span>
        <span class="keyword">def</span> old = sql.firstRow(<span class="string"><span class="delimiter">&quot;</span><span class="content">select count(*) as toolCount from testing_tool</span><span class="delimiter">&quot;</span></span>).toolCount
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into testing_tool values (4, 'junit', '5')</span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">def</span> actual = sql.firstRow(<span class="string"><span class="delimiter">&quot;</span><span class="content">select count(*) as toolCount from testing_tool</span><span class="delimiter">&quot;</span></span>).toolCount

        <span class="comment">// verify</span>
        assertThat(actual, is(old + <span class="integer">1</span>))
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this case, Spock has introduced small but very useful feature. You can wrap any variable or method invocation by <code>old()</code> inside <code>then</code> block and it will be replaced by the corresponding value <strong>before execution of previous <code>when</code> block</strong>:</p>
</div>
<div class="listingblock">
<div class="title">Asserting changes with Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">modifying data in table</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">add JUnit 5 to the list of unit testing tools</span><span class="delimiter">'</span></span>
        sql.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into testing_tool values (4, 'junit', '5')</span><span class="delimiter">&quot;</span></span>)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">number of tools should be incremented</span><span class="delimiter">'</span></span>
        sql.firstRow(<span class="string"><span class="delimiter">&quot;</span><span class="content">select count(*) as toolCount from testing_tool</span><span class="delimiter">&quot;</span></span>).toolCount ==
                old(sql.firstRow(<span class="string"><span class="delimiter">&quot;</span><span class="content">select count(*) as toolCount from testing_tool</span><span class="delimiter">&quot;</span></span>).toolCount) + <span class="integer">1</span>
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="timeouts">11.2. Timeouts</h3>
<div class="paragraph">
<p>Test timeouts are implemented very similarly in both JUnit and TestNG:</p>
</div>
<div class="listingblock">
<div class="title">Test timeouts via JUnit</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>(timeout = <span class="integer">2000</span>)
    <span class="directive">public</span> <span class="type">void</span> infiniteLoop() {
        <span class="comment">// setup</span>
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt; arrayList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

        <span class="comment">// run</span>
        <span class="keyword">while</span> (<span class="predefined-constant">true</span>) { arrayList.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">junit forever!</span><span class="delimiter">&quot;</span></span>); }
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Test timeouts via TestNG</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>(timeOut = <span class="integer">2000</span>)
    <span class="directive">public</span> <span class="type">void</span> infiniteLoop() {
        <span class="comment">// setup</span>
        <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt; arrayList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

        <span class="comment">// run</span>
        <span class="keyword">while</span> (<span class="predefined-constant">true</span>) { arrayList.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">testng forever!</span><span class="delimiter">&quot;</span></span>); }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Really, it&#8217;s hard to improve something there besides arguing is it 'timeout' or 'time out'.
But as test code readability is one of main Spock goals, there is an obvious improvement for it:</p>
</div>
<div class="listingblock">
<div class="title">Test timeouts via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@Timeout</span>(value = <span class="integer">2</span>, unit = <span class="predefined-type">TimeUnit</span>.SECONDS)
    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">infinite loop</span><span class="delimiter">'</span></span>() {
        <span class="key">setup</span>: <span class="string"><span class="delimiter">'</span><span class="content">array list</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> arrayList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;()

        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">we will add to it values forever</span><span class="delimiter">'</span></span>
        <span class="keyword">while</span> (<span class="predefined-constant">true</span>) { arrayList.add(<span class="string"><span class="delimiter">'</span><span class="content">spock forever!</span><span class="delimiter">'</span></span>) }
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing_async_code">11.3. Testing async code</h3>
<div class="paragraph">
<p>While two previous features were so small and minor, the next one is really important.
How can we test async code? Let&#8217;s forget for now that is should be turned to synchronous before testing.
Sometime it&#8217;s impossible, sometimes it&#8217;s not reasonable.
The most simple and the most strange approach is just ignoring that code is async:</p>
</div>
<div class="listingblock">
<div class="title">Testing async code using ignorance</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@Test</span>
    <span class="type">void</span> iWantToBelieve() {
        <span class="comment">// setup</span>
        <span class="predefined-type">Integer</span> actual = <span class="predefined-constant">null</span>

        <span class="comment">// run</span>
        asyncNextPrime( <span class="integer">1728</span>, { answer -&gt; actual = answer } )

        <span class="comment">// verify</span>
        <span class="keyword">assert</span> actual == <span class="integer">1733</span>
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, such approach will not work in slightly more than 100% cases.
The most obvious improvement is to add some reasonable delay before asserting async result:</p>
</div>
<div class="listingblock">
<div class="title">Testing async code using sleeping</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@Test</span>
    <span class="type">void</span> hm() {
        <span class="comment">// setup</span>
        <span class="predefined-type">Integer</span> actual = <span class="predefined-constant">null</span>

        <span class="comment">// run</span>
        asyncNextPrime( <span class="integer">1728</span>, { answer -&gt; actual = answer } )

        <span class="comment">// hm</span>
        <span class="predefined-type">Thread</span>.sleep(<span class="integer">3000</span>)

        <span class="comment">// verify</span>
        <span class="keyword">assert</span> actual == <span class="integer">1733</span>
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>While it will work sometimes, such approach has two problems: sometimes async call will finish long time before delay does and this time will be wasted, and sometimes async call will last a little longer than delay does and the test will fail.
The more intelligent approach is to add some logic to check if async call is finished:</p>
</div>
<div class="listingblock">
<div class="title">Testing async code using more intelligent approach</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@Test</span>(timeout = <span class="integer">3000L</span>)
    <span class="type">void</span> complicatedHm() {
        <span class="comment">// setup</span>
        <span class="predefined-type">Integer</span> actual = <span class="predefined-constant">null</span>

        <span class="comment">// run</span>
        asyncNextPrime( <span class="integer">1728</span>, { answer -&gt; actual = answer } )

        <span class="comment">// hmhm</span>
        <span class="keyword">while</span> (actual == <span class="predefined-constant">null</span>) {
            <span class="keyword">if</span> (actual != <span class="predefined-constant">null</span>) {
                <span class="comment">// verify</span>
                <span class="keyword">assert</span> actual == <span class="integer">1733</span>
            }
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The problem of this approach is that, actually, it&#8217;s a very clear test code anti-pattern. For many reasons, keeping non-linear logic in test code reduces tests reliability a lot.</p>
</div>
<div class="paragraph">
<p>Spock suggests two native features for testing async code.</p>
</div>
<div class="paragraph">
<p>First one is called 'polling conditions' and it evaluates assertions regularly until they become <code>true</code> or timeout is reached.
Assertion is considered as failed if it does not become <code>true</code> within specified time limit:</p>
</div>
<div class="listingblock">
<div class="title">Testing async code using polling conditions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">N36S_PollingConditions</span> <span class="directive">extends</span> Specification {

    <span class="keyword">def</span> conditions = <span class="keyword">new</span> PollingConditions(<span class="key">timeout</span>: <span class="integer">30</span>)

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">find next prime after 1728 eventually</span><span class="delimiter">'</span></span>() {
        <span class="key">setup</span>: <span class="string"><span class="delimiter">'</span><span class="content">holder for answer</span><span class="delimiter">'</span></span>
        <span class="predefined-type">Integer</span> actual = <span class="predefined-constant">null</span>

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">async start calculating next prime after 1728</span><span class="delimiter">'</span></span>
        asyncNextPrime( <span class="integer">1728</span>, { answer -&gt; actual = answer } )

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">eventually answer will be found</span><span class="delimiter">'</span></span>
        conditions.eventually {
            <span class="keyword">assert</span> actual == <span class="integer">1733</span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Second feature is called 'async conditions' and it is used to pass assertion expressions as callback for async code.
Assertion will be evaluated ones as usual when async call finishes or it will be considered as failed if it will be not reached within time limit:</p>
</div>
<div class="listingblock">
<div class="title">Testing async code using async conditions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">N37S_AsyncCondition</span> <span class="directive">extends</span> Specification {

    <span class="keyword">def</span> conditions = <span class="keyword">new</span> AsyncConditions()

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">find next prime after 2817 within 3 seconds</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">async start calculating next prime after 1728</span><span class="delimiter">'</span></span>
        asyncNextPrime( <span class="integer">1728</span>, { answer -&gt;
            conditions.evaluate { <span class="keyword">assert</span> answer == <span class="integer">1733</span> }
        } )

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">within 3 seconds answer will be found</span><span class="delimiter">'</span></span>
        conditions.await(<span class="integer">3</span>)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test_execution_control">12. Test execution control</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/spock-a8dfe.png" alt="spock a8dfe">
</div>
</div>
<div class="sect2">
<h3 id="disabling_tests">12.1. Disabling tests</h3>
<div class="paragraph">
<p>The most simple test execution control feature is possibility to disable some of test cases.
It&#8217;s implemented pretty similar in our traditional test frameworks:</p>
</div>
<div class="listingblock">
<div class="title">Disabling tests via JUnit</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Ignore</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">will fix it before commit</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> alwaysIgnored() {
        <span class="comment">// TODO FIXME test is failing</span>
        assertThat(<span class="integer">2</span>+<span class="integer">2</span>, is(<span class="integer">5</span>));
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Disabling tests via TestNG</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>(enabled = <span class="predefined-constant">false</span>)
    <span class="directive">public</span> <span class="type">void</span> alwaysIgnored() {
        <span class="comment">// TODO FIXME test is failing</span>
        assertEquals(<span class="integer">2</span>+<span class="integer">2</span>, <span class="integer">5</span>);
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Disabling tests via JUnit 5</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Disabled</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">will fix it before commit</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> alwaysIgnored() {
        <span class="comment">// TODO FIXME test is failing</span>
        assertEquals(<span class="integer">5</span>, <span class="integer">2</span>+<span class="integer">2</span>);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no surprise that Spock can do the same:</p>
</div>
<div class="listingblock">
<div class="title">Disabling tests via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@Ignore</span>(<span class="string"><span class="delimiter">'</span><span class="content">will fix it before commit</span><span class="delimiter">'</span></span>)
    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">this test is always ignored</span><span class="delimiter">'</span></span>() {
        <span class="comment">// TODO FIXME test is failing</span>
        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">that 2+2=5</span><span class="delimiter">'</span></span>
        <span class="integer">2</span> + <span class="integer">2</span> == <span class="integer">5</span>
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>What is more interesting is conditional disabling.
In JUnit it is implemented with Assumptions API.
Assumptions are very similar to assertions, but when they fail, it causes test to be skipped, not failed:</p>
</div>
<div class="listingblock">
<div class="title">Conditional disabling tests via JUnit</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> ignoredOnWindows() {
        assumeThat(<span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">os.name</span><span class="delimiter">&quot;</span></span>).toLowerCase(), is(not(containsString(<span class="string"><span class="delimiter">&quot;</span><span class="content">windows</span><span class="delimiter">&quot;</span></span>))));</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Spock, the same feature is implemented as part of Ignore API.
Moreover, it has more various features like disabling and enabling conditions and predefined conditions (environment operating system, installed java version, system properties and environment variables):</p>
</div>
<div class="listingblock">
<div class="title">Conditional disabling tests via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@IgnoreIf</span>({ os.windows || sys[<span class="string"><span class="delimiter">'</span><span class="content">pretend.os</span><span class="delimiter">'</span></span>] == <span class="string"><span class="delimiter">'</span><span class="content">windows</span><span class="delimiter">'</span></span> })
    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">this test is ignored on Windows</span><span class="delimiter">'</span></span>() {
        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">that we are not on Windows</span><span class="delimiter">'</span></span>
        !<span class="predefined-type">System</span>.properties[<span class="string"><span class="delimiter">'</span><span class="content">os.name</span><span class="delimiter">'</span></span>].toString().toLowerCase().contains(<span class="string"><span class="delimiter">'</span><span class="content">windows</span><span class="delimiter">'</span></span>)
    }

    <span class="annotation">@Requires</span>({ jvm.java8 &amp;&amp; env[<span class="string"><span class="delimiter">'</span><span class="content">JAVA_HOME</span><span class="delimiter">'</span></span>] != <span class="predefined-constant">null</span> })
    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">this test requires JAVA_HOME set and Java 8 installed</span><span class="delimiter">'</span></span>() {
        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">that we are on Java 8</span><span class="delimiter">'</span></span>
        <span class="string"><span class="delimiter">'</span><span class="content">java -version</span><span class="delimiter">'</span></span>.execute().errorStream.text.contains(<span class="string"><span class="delimiter">'</span><span class="content">java version &quot;1.8.0_73&quot;</span><span class="delimiter">'</span></span>)
    }

    <span class="annotation">@IgnoreIf</span>({ <span class="keyword">new</span> <span class="predefined-type">Random</span>().nextBoolean() })
    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">this test is SOMETIMES ignored</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">i hate my job</span><span class="delimiter">'</span></span>
        <span class="predefined-type">Integer</span>.metaClass.plus = { <span class="predefined-type">Integer</span> other -&gt;
            <span class="keyword">return</span> <span class="integer">5</span>
        }

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">i can make them pay</span><span class="delimiter">'</span></span>
        <span class="integer">2</span> + <span class="integer">2</span> == <span class="integer">5</span>
    }

    <span class="annotation">@Requires</span>({ N40S_ConditionalRuns_Part2.isGoogleSearchAvaiable() })
    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">this test runs only if Google Search is avaiable</span><span class="delimiter">'</span></span>() {
        <span class="key">setup</span>: <span class="string"><span class="delimiter">'</span><span class="content">http connection service</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> http = <span class="keyword">new</span> HTTPBuilder(<span class="string"><span class="delimiter">'</span><span class="content">https://google.com</span><span class="delimiter">'</span></span>)

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">we search for the best java unit testing framework</span><span class="delimiter">'</span></span>
        <span class="keyword">def</span> response = http.get(path : <span class="string"><span class="delimiter">'</span><span class="content">/search</span><span class="delimiter">'</span></span>, query : [<span class="key">q</span>:<span class="string"><span class="delimiter">'</span><span class="content">best java unit testing framework</span><span class="delimiter">'</span></span>])

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">answer mentions spock</span><span class="delimiter">'</span></span>
        response.toString().toLowerCase().contains <span class="string"><span class="delimiter">'</span><span class="content">spock</span><span class="delimiter">'</span></span>
    }

    <span class="directive">static</span> <span class="type">boolean</span> isGoogleSearchAvaiable() {
        <span class="keyword">try</span> {
            <span class="keyword">new</span> HTTPBuilder(<span class="string"><span class="delimiter">'</span><span class="content">http://www.google.com</span><span class="delimiter">'</span></span>).get([:])
            <span class="keyword">return</span> <span class="predefined-constant">true</span>
        } <span class="keyword">catch</span> (e) {
            <span class="keyword">return</span> <span class="predefined-constant">false</span>
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides that, Spock has one more small and very useful feature, especially for functional testing.
If you need to re-run just one single test from the full suite, you no longer need to mark all the rest with <code>@Ignore</code>.
Please welcome self-describing <code>@IgnoreRest</code> annotation:</p>
</div>
<div class="listingblock">
<div class="title">Disabling tests via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@IgnoreRest</span>
    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">this test makes all other test ignored</span><span class="delimiter">'</span></span>() {
        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">a miracle</span><span class="delimiter">'</span></span>
        <span class="integer">2</span> + <span class="integer">2</span> == <span class="integer">5</span>
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, Spock 1.1 introduces one more interesting way to disable test case called Pending Feature.
If you mark test case with a <code>@PendingFeature</code> annotation, it will have following behavior:
if it fails, it will be reported as skipped (ignored) test case, as test case for unimplemented feature is not important for overall test result;
if it passed, it will be reported as failed (sic!) test case, as it&#8217;s strange that test case for unimplemented features succeeded, so it should be explicitly reported:</p>
</div>
<div class="listingblock">
<div class="title">Pending Feature in Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@PendingFeature</span>
    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">this test is passing</span><span class="delimiter">'</span></span>() {
        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">that 2*2=4</span><span class="delimiter">'</span></span>
        <span class="integer">2</span> * <span class="integer">2</span> == <span class="integer">4</span>
    }

    <span class="annotation">@PendingFeature</span>
    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">this test is failing</span><span class="delimiter">'</span></span>() {
        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">that 2*2=5</span><span class="delimiter">'</span></span>
        <span class="integer">2</span> * <span class="integer">2</span> == <span class="integer">5</span>
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="test_suites">12.2. Test suites</h3>
<div class="paragraph">
<p>Following usual pattern for this article let&#8217;s look how we can organize test suites in traditional test frameworks:</p>
</div>
<div class="listingblock">
<div class="title">Test suites via JUnit</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Category</span>(Fast.class) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> passedFast() {
        assertThat(<span class="integer">2</span>+<span class="integer">2</span>, is(<span class="integer">4</span>));
    }

    <span class="annotation">@Category</span>(Slow.class) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> failingIn20Seconds() <span class="directive">throws</span> <span class="exception">InterruptedException</span> {
        <span class="predefined-type">Thread</span>.sleep(<span class="predefined-type">TimeUnit</span>.SECONDS.toMillis(<span class="integer">20</span>));
        assertThat(<span class="integer">2</span>+<span class="integer">2</span>, is(<span class="integer">4</span>));
    }

<span class="annotation">@RunWith</span>(Categories.class)
<span class="annotation">@Categories</span>.IncludeCategory(Fast.class) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@Suite</span>.SuiteClasses(N45J_TestSuites_1.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">N45J_TestSuites_2</span> {}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Suites tagging</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Suites selection</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Test suites via TestNG</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>(groups = <span class="string"><span class="delimiter">&quot;</span><span class="content">fast</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="type">void</span> passedFast() {
        assertEquals(<span class="integer">2</span>+<span class="integer">2</span>, <span class="integer">4</span>);
    }

    <span class="annotation">@Test</span>(groups = <span class="string"><span class="delimiter">&quot;</span><span class="content">slow</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="type">void</span> failingIn20Seconds() <span class="directive">throws</span> <span class="exception">InterruptedException</span> {
        <span class="predefined-type">Thread</span>.sleep(<span class="predefined-type">TimeUnit</span>.SECONDS.toMillis(<span class="integer">20</span>));
        assertEquals(<span class="integer">2</span>+<span class="integer">2</span>, <span class="integer">5</span>);
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Suites tagging</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">src/test/resources/testng.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE suite SYSTEM &quot;http://testng.org/testng-1.0.dtd&quot; &gt;</span>
<span class="tag">&lt;suite</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Suites</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;test</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestSuites</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;groups&gt;</span>
            <span class="tag">&lt;run&gt;</span>
                <span class="tag">&lt;include</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fast</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
                <span class="tag">&lt;exclude</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">slow</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="tag">&lt;/run&gt;</span>
        <span class="tag">&lt;/groups&gt;</span>
        <span class="tag">&lt;classes&gt;</span>
            <span class="tag">&lt;class</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">N46T_TestSuites</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/classes&gt;</span>
    <span class="tag">&lt;/test&gt;</span>
<span class="tag">&lt;/suite&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Suites selection</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Test suites via JUnit 5</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Tag</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">fast</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> passedFast() {
        assertEquals(<span class="integer">4</span>, <span class="integer">2</span>+<span class="integer">2</span>);
    }

    <span class="annotation">@Tag</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">slow</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> failingIn20Seconds() <span class="directive">throws</span> <span class="exception">InterruptedException</span> {
        <span class="predefined-type">Thread</span>.sleep(<span class="predefined-type">TimeUnit</span>.SECONDS.toMillis(<span class="integer">20</span>));
        assertEquals(<span class="integer">5</span>, <span class="integer">2</span>+<span class="integer">2</span>);
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Suites tagging</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Spock (no surprises) does the same, but again and again preferring code over strings or XMLs:</p>
</div>
<div class="listingblock">
<div class="title">Test suites via Spock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@Fast</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">def</span> <span class="function">passedFast</span>() {
        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">that everything is ok</span><span class="delimiter">'</span></span>
        <span class="integer">2</span> + <span class="integer">2</span> == <span class="integer">4</span>
    }

    <span class="annotation">@Slow</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">def</span> <span class="function">failingIn20Seconds</span>() {
        <span class="key">setup</span>: <span class="string"><span class="delimiter">'</span><span class="content">some resource</span><span class="delimiter">'</span></span>
        <span class="predefined-type">Thread</span>.sleep(<span class="predefined-type">TimeUnit</span>.SECONDS.toMillis(<span class="integer">20</span>))

        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">that everything is not ok</span><span class="delimiter">'</span></span>
        <span class="integer">2</span> + <span class="integer">2</span> == <span class="integer">5</span>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Suites tagging</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">src/test/resources/SpockConfig.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">runner {
    include Fast <i class="conum" data-value="1"></i><b>(1)</b>
    exclude Slow <i class="conum" data-value="1"></i><b>(1)</b>

    optimizeRunOrder <span class="predefined-constant">true</span> <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Suites selection</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>And one more! This key reorders tests to run all failed first, starting from the most fast ones to the most slow.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="miscellanea">13. Miscellanea</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/spock-52d3a.png" alt="spock 52d3a">
</div>
</div>
<div class="paragraph">
<p>There are a number of Spock feature worth mentioning as well.</p>
</div>
<div class="paragraph">
<p>Being a good topic for separate article, there is a very simple and convenient mechanism of creating Spock extensions.
Just as quick example, to print test inner structure to console all you need is:</p>
</div>
<div class="listingblock">
<div class="title">Spock extensions example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.spockframework.runtime.AbstractRunListener</span>
<span class="keyword">import</span> <span class="include">org.spockframework.runtime.extension.AbstractAnnotationDrivenExtension</span>
<span class="keyword">import</span> <span class="include">org.spockframework.runtime.model.FeatureInfo</span>
<span class="keyword">import</span> <span class="include">org.spockframework.runtime.model.SpecInfo</span>

<span class="type">class</span> <span class="class">ReportExtension</span> <span class="directive">extends</span> AbstractAnnotationDrivenExtension&lt;Report&gt; { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Override</span>
    <span class="type">void</span> visitSpecAnnotation(Report annotation, SpecInfo spec) {
        spec.addListener(<span class="keyword">new</span> AbstractRunListener() { <i class="conum" data-value="2"></i><b>(2)</b>

            <span class="annotation">@Override</span>
            <span class="type">void</span> afterFeature(FeatureInfo feature) {
                <span class="keyword">for</span> (block <span class="keyword">in</span> feature.blocks) { <i class="conum" data-value="3"></i><b>(3)</b>
                    <span class="keyword">for</span> (text <span class="keyword">in</span> block.texts) { <i class="conum" data-value="4"></i><b>(4)</b>
                        println <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>block.kind.name().toLowerCase()<span class="inline-delimiter">}</span></span><span class="content"> </span><span class="inline"><span class="inline-delimiter">$</span>text</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="5"></i><b>(5)</b>
                    }
                }
            }
        })
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Extensions is enabled by <code>@Report</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Attaching listener to Spock specification processor</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>For each test block</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>For each text string describing test block</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Print it to console</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you need your test to change system properties there is always a challenge to restore them back after test execution.
Spock introduces annotation <code>@RestoreSystemProperties</code>, which does exactly the thing.
For the sake of example, another Spock annotation is used: <code>@Stepwise</code>, which makes Spock to execute tests in the order they are specified in the code.
Being damned in the unit testing worlds, it is more than useful for integration and functional tests:</p>
</div>
<div class="listingblock">
<div class="title"><code>@RestoreSystemProperties</code> and <code>@Stepwise</code> example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Stepwise</span>
<span class="type">class</span> <span class="class">N48S_SystemProperties</span> <span class="directive">extends</span> Specification {

    <span class="annotation">@RestoreSystemProperties</span>
    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">set spock version</span><span class="delimiter">'</span></span>() {
        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">that spock.version is not set</span><span class="delimiter">'</span></span>
        <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">spock.version</span><span class="delimiter">'</span></span>) == <span class="predefined-constant">null</span>

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">spock version is set</span><span class="delimiter">'</span></span>
        <span class="predefined-type">System</span>.setProperty(<span class="string"><span class="delimiter">'</span><span class="content">spock.version</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">we can retrieve its value back</span><span class="delimiter">'</span></span>
        <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">spock.version</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">check spock version is not set</span><span class="delimiter">'</span></span>() {
        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">that spock.version is not set</span><span class="delimiter">'</span></span>
        <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">spock.version</span><span class="delimiter">'</span></span>) == <span class="predefined-constant">null</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes, when a complex object needs to be checked, it can be useful to group all assertions within <code>with</code> group as follows:</p>
</div>
<div class="listingblock">
<div class="title"><code>with</code> example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">list is not empty, is of size 4, and contains all added values</span><span class="delimiter">'</span></span>
        with(list) {
            empty == <span class="predefined-constant">false</span>
            size() == <span class="integer">4</span>
            get(<span class="integer">0</span>) == <span class="string"><span class="delimiter">'</span><span class="content">we</span><span class="delimiter">'</span></span>
            get(<span class="integer">1</span>) == <span class="string"><span class="delimiter">'</span><span class="content">will</span><span class="delimiter">'</span></span>
            get(<span class="integer">2</span>) == <span class="string"><span class="delimiter">'</span><span class="content">love</span><span class="delimiter">'</span></span>
            get(<span class="integer">3</span>) == <span class="string"><span class="delimiter">'</span><span class="content">spock</span><span class="delimiter">'</span></span>
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, complex assertions can be grouped inside <code>verifyAll</code> block.
It will assert multiple expressions without short-circuiting those after a failure, so all failures will be reported:</p>
</div>
<div class="listingblock">
<div class="title"><code>verifyAll</code> example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">list is not empty, is of size 3, and contains all added values</span><span class="delimiter">'</span></span>
        verifyAll {
            list.empty == <span class="predefined-constant">false</span>
            list.size() == <span class="integer">3</span>
            list.get(<span class="integer">0</span>) == <span class="string"><span class="delimiter">'</span><span class="content">we</span><span class="delimiter">'</span></span>
            list.get(<span class="integer">1</span>) == <span class="string"><span class="delimiter">'</span><span class="content">love</span><span class="delimiter">'</span></span>
            list.get(<span class="integer">2</span>) == <span class="string"><span class="delimiter">'</span><span class="content">spock</span><span class="delimiter">'</span></span>
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a rule, Spock does not ignore previously implemented traditional features.
This is great, as JUnit Rules still work with Spock:</p>
</div>
<div class="listingblock">
<div class="title">JUnit Rules example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">N51S_JUnitRules</span> <span class="directive">extends</span> Specification {

    <span class="annotation">@org</span>.junit.Rule OutputCapture capture = <span class="keyword">new</span> OutputCapture()

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">capture output print method</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">text is printed to console</span><span class="delimiter">'</span></span>
        print <span class="string"><span class="delimiter">&quot;</span><span class="content">2 + 2 = </span><span class="inline"><span class="inline-delimiter">${</span><span class="integer">2</span>+<span class="integer">2</span><span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">it is printed as expected</span><span class="delimiter">'</span></span>
        capture.toString() == <span class="string"><span class="delimiter">'</span><span class="content">2 + 2 = 4</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spock does not forget Groovy-specific features.
For example, it supports metaprogramming testing.
<code>@ConfineMetaClassChanges</code> confine all metaprogramming tricks within test where they are declared:</p>
</div>
<div class="listingblock">
<div class="title">Metaprogramming testing example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@ConfineMetaClassChanges</span>([<span class="predefined-type">Integer</span>])
    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">sometimes 2 + 2 = 5</span><span class="delimiter">'</span></span>() {
        <span class="key">setup</span>: <span class="string"><span class="delimiter">'</span><span class="content">very special Integer + Integer operation</span><span class="delimiter">'</span></span>
        <span class="predefined-type">Integer</span>.metaClass.plus = { <span class="predefined-type">Integer</span> other -&gt;
            <span class="keyword">return</span> <span class="integer">5</span>
        }

        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">2 + 2 == 5</span><span class="delimiter">'</span></span>
        <span class="integer">2</span> + <span class="integer">2</span> == <span class="integer">5</span>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">usually 2 + 2 == 4</span><span class="delimiter">'</span></span>() {
        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">2 + 2 == 4</span><span class="delimiter">'</span></span>
        <span class="integer">2</span> + <span class="integer">2</span> == <span class="integer">4</span>
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, Spock has plenty of integrations, among which Spring and Grails are the most important:</p>
</div>
<div class="listingblock">
<div class="title">Spock-Spring integration example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@ContextConfiguration</span>(classes = Config)
<span class="type">class</span> <span class="class">N22S_Stubs</span> <span class="directive">extends</span> Specification {

    <span class="annotation">@Autowired</span>
    PasswordGenerator passwordGenerator</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="geb">14. Geb</h2>
<div class="sectionbody">
<div class="paragraph">
<p>And the last thing, that worth special mention is <a href="http://www.gebish.org/" target="_blank">Geb</a>.
Geb is a browser automation solution, developed by one of Spock main contributor Luke Daley.
It brings together the power of WebDriver, the elegance of jQuery content selection, the robustness of Page Object modelling and the expressiveness of the Groovy language.
It can be used for scripting, scraping and general automation — or equally as a functional/web/acceptance testing solution.
And preferable Geb testing approach is greatly inspired by Spock framework.
Just look at simple example:</p>
</div>
<div class="listingblock">
<div class="title">Geb example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">geb.spock.GebSpec</span>
<span class="keyword">import</span> <span class="include">spock.lang.Title</span>

<span class="annotation">@Title</span>(<span class="string"><span class="delimiter">'</span><span class="content">Geb example</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">N49S_Geb</span> <span class="directive">extends</span> GebSpec {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">search for wikipedia in google</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">go to google.com</span><span class="delimiter">'</span></span>
        go <span class="string"><span class="delimiter">'</span><span class="content">http://www.google.com</span><span class="delimiter">'</span></span>

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">page title is Google</span><span class="delimiter">'</span></span>
        title == <span class="string"><span class="delimiter">'</span><span class="content">Google</span><span class="delimiter">'</span></span>

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">enter wikipedia and click on search</span><span class="delimiter">'</span></span>
        <span class="error">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">input</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">q</span><span class="delimiter">'</span></span>).value(<span class="string"><span class="delimiter">'</span><span class="content">wikipedia</span><span class="delimiter">'</span></span>)
        <span class="error">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">input</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">btnG</span><span class="delimiter">'</span></span>).click()

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">title is wikipedia</span><span class="delimiter">'</span></span>
        waitFor { title.startsWith <span class="string"><span class="delimiter">'</span><span class="content">wikipedia - </span><span class="delimiter">'</span></span> }

        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">that search result contains link to ru.wikipedia.org</span><span class="delimiter">'</span></span>
        <span class="error">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span>, <span class="integer">0</span>).text().contains(<span class="string"><span class="delimiter">'</span><span class="content">ru.wikipedia.org</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even if you like JUnit or TestNG so much that you don&#8217;t want to migrate them, you can introduce Spock into your project via Geb.
Geb is obviously the best in his role and if you need web functionally testing it is more than worth trying.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="why_use_spock">15. Why Use Spock?</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Concise syntax</strong>
If you are tired with verbosity and ceremonies of Java, which are multiplied several times for test code, Spock is a great choice.
It uses Groovy magic and own features to make your test code short but still understandable.</p>
</li>
<li>
<p><strong>Language for testing instead of testing struggling language</strong>
Naturally, you use language features to express your intent in test (and not only test) code.
If you use language designed specially for testing, you will obviously always can find constructions that were designed specially for your case.
And when you use general-purpose language like Java for testing you just try to make it fit your needs, which is not working well in all cases.</p>
</li>
<li>
<p><strong>Clear test structure</strong>
Spock enforce inner test structure.
Being a generally good practice to do it via comments or method separation in traditional test frameworks, Spock makes it true in 100% test cases.</p>
</li>
<li>
<p><strong>Code and reports readable for everyone</strong>
While Spock code is by design and by Spock philosophy can be read even by non-development folks like QA engineers or managers, it&#8217;s also possible to immediately share Spock reports with anyone interested without any additional post-processing.</p>
</li>
<li>
<p><strong>Powerful built-in features</strong>
Spock has plenty of small and huge built-in features ready to cover any of your need immediately.
Even for your 1% chance test requirement there probably is a Spock feature that makes it easier and more pleasant to develop.</p>
</li>
<li>
<p><strong>Extensions</strong>
Even if Spock does not have a good feature for your case, it has simple and powerful extension mechanism which you can use to make it better fit your needs.</p>
</li>
<li>
<p><strong>Integrations</strong>
Spock seamlessly integrates with Spring, Grails, Guice, Tapestry, Unitils; JUnit, Mockito, Hamcrest, AssertJ, Google Truth and others.</p>
</li>
<li>
<p><strong>One framework for any testing approach</strong>
Spock philosophy states that you should be able to use single Spock library for any possible testing approach.
So, Spock is useful for unit, integration and functional testing.
Spock has powerful native support of assertions and mocking.
Spock is good for TDD, BDD and chaotic testing.
And anyway, Spock can be greatly integrated with helper testing libraries like Hamcrest, Mockito or others, if you want to.</p>
</li>
<li>
<p><strong>Behaves as one more JUnit runner</strong>
Inside, besides tons of pure magic, Spock is just one more JUnit runner.
It means that is integrates easily with build tools, CI/CD tools, reporting libraries and actually everything that accepts JUnit.</p>
</li>
<li>
<p><strong>Works for both Groovy and Java</strong>
Being great part of Groovy world, just like many other Groovy projects, there is no great need to dig into Groovy to understand Spock.
After getting its main concepts, you can test both Groovy and Java code, using either Groovy or pure Java expressions inside test blocks.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="why_do_not_use_spock">16. Why Do Not Use Spock?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first thing you should keep in mind about Spock, is that usually you can find corresponding features in JUnit or TestNG.
If no, Hamcrest/AssertJ/Mockito/someone can probably help you.
If still no, you can try to imitate some of Spock features even within JUnit/TestNG limitations.
Being not so beautiful, it will work in 90% of the cases, while Spock is just a fresh look on the traditional approaches or even when it introduces new features that can be reproduced.</p>
</div>
<div class="paragraph">
<p>Another thing is that Spock is now in the process of finding new development model.
Luke Daley has left the project long time ago.
Peter Niederwleser has stopped Spock contribution more than a year ago after joining Apple.
Now Spock is public <a href="https://github.com/spockframework/spock" target="_blank">Github project</a>, and after some standstill after 1.0 release seems that now it is on the way to stable wide community development model, as 1.1 release is almost ready for GA.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/article-27c07.png" alt="article 27c07">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="when_use_spock">17. When Use Spock?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The main precondition before start using Spock, is your team being ready to accept it.
There is no other limitation or significant expected problems for it.
Spock integrates well with all your other solutions, can be easily migrated from existing JUnit/TestNG code, does not require great additional  knowledge or efforts to maintain.</p>
</div>
<div class="paragraph">
<p>Obviously, the simplest case is when you are about to start new project: just use Spock from the very beginning and enjoy it, nothing more.
If you have legacy code without unit testing coverage, the case is pretty similar: it&#8217;s not a problem to start using Spock for it immediately.</p>
</div>
<div class="paragraph">
<p>If you already have JUnit tests in your code, the good strategy for Spock migration is start developing new test cases via Spock.
As Spock is in some way just a JUnit runner both test suites are integrated into one view without any efforts.
During the further process, you can start continuous migration from JUnit to Spock one test class by one, which is very easy as renaming files and changing five lines of code for each test case.
For the TestNG, things are little bit harder, so good strategy will be keeping two separate test suites and quick migration from TestNG to Spock.</p>
</div>
<div class="paragraph">
<p>And the last great entrance point for Spock into your project is Geb.
If you are about to introduce functional testing into your web project, Geb will be the best choise, that besides all other benefits, will introduce Spock to your team.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="looking_further">18. Looking Further</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Thanks for your attention!
If you do like or don&#8217;t like this article, please share your opinion.
I will appreciate your feedback (including surely negative one) in any form available for my attention (like social media, direct e-mail, or etc.).</p>
</div>
<div class="paragraph">
<p>If you are interested in this topic I can recommend you following resources:</p>
</div>
<div class="paragraph">
<p>To read:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://spockframework.github.io/spock/docs/1.0/index.html" target="_blank">Spock documentation</a></p>
</li>
<li>
<p><a href="http://mrhaki.blogspot.com/search/label/Spock" target="_blank">mrhaki block filtered on Spock</a></p>
</li>
<li>
<p><a href="http://codepipes.com/presentations/spock-vs-junit.pdf" target="_blank">Spock vs JUnit by Kostis Kapelonis</a></p>
</li>
<li>
<p><a href="https://speakerdeck.com/szpak/smarter-testing-java-code-with-spock-framework" target="_blank">Smarter testing Java code with Spock Framework by Marcin Zajączkowski</a></p>
</li>
<li>
<p><a href="https://www.manning.com/books/java-testing-with-spock" target="_blank">Java Testing with Spock by Konstantinos Kapelonis</a></p>
</li>
<li>
<p><a href="http://www.gebish.org/manual/current/" target="_blank">Geb documentation</a></p>
</li>
<li>
<p><a href="http://www.slideshare.net/JacobAaeMikkelsen/geb-for-browser-automation" target="_blank">Geb for browser automation by Jacob Aae Mikkelsen</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To examine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/spockframework" target="_blank">Spock Github organization</a></p>
</li>
<li>
<p><a href="https://github.com/spockframework/spock" target="_blank">Spock sources</a></p>
</li>
<li>
<p><a href="https://github.com/spockframework/spock-example" target="_blank">Spock examples</a></p>
</li>
<li>
<p><a href="https://github.com/spockframework/spock/tree/master/spock-specs/src/test/groovy/org/spockframework/smoke" target="_blank">Spock self smoke tests</a></p>
</li>
<li>
<p><a href="https://github.com/renatoathaydes/spock-reports" target="_blank">Spock reports project</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To try:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://meetspock.appspot.com/" target="_blank">Spock web console</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To watch:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.youtube.com/watch?v=RuTupC0I59M" target="_blank">Idiomatic Spock by Rob Fletcher</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=i28F13zZwlg" target="_blank">Spock: A Logical Framework for Enterprise Testing by Ken Kousen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-09-21 03:37:06 +03:00
</div>
</div>
</body>
</html>